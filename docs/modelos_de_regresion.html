<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>modelos_de_regresion.knit</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-2.0.6/clipboard.min.js"></script>
<link href="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
<script src="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
<script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="extra.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R avanzado</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Manuales
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="fundamentos_de_r.html">Fundamentos de R</a>
    </li>
    <li>
      <a href="reportes_dinamicos_con_rmarkdown.html">Reportes dinámicos con Rmarkdown</a>
    </li>
    <li>
      <a href="funciones.html">Funciones</a>
    </li>
    <li>
      <a href="bucles_loops.html">Bucles</a>
    </li>
    <li>
      <a href="modelos_de_regresion.html">Modelos de regresión</a>
    </li>
    <li>
      <a href="stadistica_tradicional_en_regresiones.html">Modelos comunes como regresiones</a>
    </li>
    <li>
      <a href="graficos_con_ggplot2.html">Gráficos con ggplot2</a>
    </li>
  </ul>
</li>
<li>
  <a href="preparacion_curso.html">Preparación para el curso</a>
</li>
<li>
  <a href="https://codefile.io/f/XOIzH23KfULuZKyZ1TYT">Compartir código</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tareas
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tarea_4.html">Tarea 4</a>
    </li>
    <li>
      <a href="respuestas_tarea_4.html">Solución: tarea 4</a>
    </li>
    <li>
      <a href="tarea_5.html">Tarea 5</a>
    </li>
    <li>
      <a href="respuestas_tarea_5.html">Solución: tarea 5</a>
    </li>
    <li>
      <a href="tarea_6.html">Tarea 6</a>
    </li>
    <li class="dropdown-header">Solución: tarea 6</li>
  </ul>
</li>
<li>
  <a href="https://github.com/maRce10/ucr_r_avanzado/raw/master/additional_files/2022-08-05_Probl%20Esp%20Ecol_Estadistica%20Avanzada%20en%20R.pdf">Programa del curso</a>
</li>
<li>
  <a href="instructor.html">Instructor</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore"><center>
<font size="7"><b>Modelos de regresión</b></font>
</center></h1>
<h3 class="subtitle"><center>
<font size="4"><b>Programación y métodos estadísticos avanzados en R</b>
</font>
</center></h3>
<h4 class="author"><center>
<font size="5"><a href="http://marceloarayasalas.weebly.com/">Marcelo
Araya-Salas, PhD</a></font>
</center></h4>
<h4 class="date"><center>
“2022-10-24”
</center></h4>

</div>


<style>
body
  { counter-reset: source-line 0; }
pre.numberSource code
  { counter-reset: none; }
</style>
<p> </p>
<div id="modelos-lineales-como-marco-unificador" class="section level1">
<h1>Modelos lineales como marco unificador</h1>
<p>Tradicionalmente, los modelos estadísticos se han enseñado como
herramientas desconectadas sin una relación clara entre ellas. Sólo hace
falta darle un vistazo a un libro clásico de estadística para biólogos
(Sokal &amp; Rolhf):</p>
<p><img src="images/sokal_rohlf.png" width="100%" style="display: block; margin: auto;" />
 </p>
<p>Sin embargo, la mayoría de esos modelos estadísticos comunes no son
más que casos especiales de modelos lineales. Por lo tanto, aprenderlos
como tales puede simplificar mucho las cosas. Este enfoque tiene varias
ventajas:</p>
<ul>
<li><p>En primer lugar, <strong>todo se reduce a
<em>y=a⋅x+b</em></strong>, lo que simplifica en gran medida el
aprendizaje</p></li>
<li><p>Esto también significa que no hay <strong>necesidad de aprender
sobre los parámetros, las hipótesis y la interpretación de los
resultados para cada caso especial</strong>.</p></li>
<li><p>Los modelos lineales se han ampliado para <strong>tener en cuenta
distribuciones y estructuras de datos complejas</strong> (por ejemplo,
modelos mixtos, modelos lineales generalizados, modelos cero-inflados,
etc.) proporcionando una <strong>plataforma más
flexible</strong>.</p></li>
<li><p>Los modelos lineales se <strong>aplican en todos los paradigmas
estadísticos</strong> (por ejemplo, frecuentista, bayesiano)</p></li>
</ul>
<p> </p>
</div>
<div id="objetivo-del-manual" class="section level1 alert alert-info">
<h1>Objetivo del manual</h1>
<p>  - Comprender la inferencia estadística a través de una única
herramienta de modelaje (modelos lineales en sentido amplio)</p>
<ul>
<li><p>Familiarizarse con la construcción de modelos lineales</p></li>
<li><p>Extender los modelos lineales a diferentes estructuras de
datos</p></li>
</ul>
</div>
<p> </p>
<hr />
<p>Paquetes a utilizar en este manual:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># vector con paquetes</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>ptqs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;viridis&quot;</span>, <span class="st">&quot;lmerTest&quot;</span>, <span class="st">&quot;sjPlot&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># bucle para instalar/cargar paquetes</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>instalado <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ptqs, <span class="cf">function</span>(y) {</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a>    ptq <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(y, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb1-8"><a href="#cb1-8"></a>    ptq <span class="ot">&lt;-</span> ptq[<span class="fu">length</span>(ptq)]</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="cf">if</span> (<span class="sc">!</span>ptq <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">&quot;Package&quot;</span>]) {</span>
<span id="cb1-11"><a href="#cb1-11"></a>        <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">&quot;/&quot;</span>, y))</span>
<span id="cb1-12"><a href="#cb1-12"></a>            remotes<span class="sc">::</span><span class="fu">install_github</span>(y, <span class="at">force =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="fu">install.packages</span>(y)</span>
<span id="cb1-13"><a href="#cb1-13"></a>    }</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>    <span class="fu">try</span>(<span class="fu">require</span>(ptq, <span class="at">character.only =</span> <span class="cn">TRUE</span>), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a>})</span></code></pre></div>
<p> </p>
<hr />
<div id="cómo-simular-datos" class="section level1">
<h1>Cómo simular datos</h1>
<div id="generación-de-números-aleatorios-en-r" class="section level2">
<h2>Generación de números aleatorios en R</h2>
<p>La estadística nos permite inferir patrones en los datos. Solemos
utilizar conjuntos de datos reales para enseñar estadística. Sin
embargo, puede ser circular entender el funcionamiento interno de una
herramienta estadística probando su capacidad para inferir un patrón que
no estamos seguros de encontrar en los datos (y no tenemos idea del
mecanismo que produjo ese patrón). <strong>Las simulaciones nos permiten
crear escenarios controlados en los que conocemos con seguridad los
patrones</strong> presentes en los datos y los procesos subyacentes que
los han generado.</p>
<p>R ofrece algunas funciones básicas para la simulación de datos. Las
más utilizadas son las funciones generadoras de números aleatorios. Los
nombres de estas funciones comienzan con <em>r</em>
(<code>r____()</code>). Por ejemplo, <code>runif()</code>:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># simular variable uniforme</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>unif_var <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span></code></pre></div>
<p> </p>
<p>El resultado es un vector numérico de longitud 100
(<code>n = 100</code>):</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># imprimir variable</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>unif_var</span></code></pre></div>
<pre><code>##   [1] 9.8891 3.9775 1.1570 0.6975 2.4375 7.9201 3.4006 9.7206 1.6586 4.5910 1.7175
##  [12] 2.3148 7.7281 0.9630 4.5345 0.8470 5.6067 0.0870 9.8574 3.1658 6.3945 2.9522
##  [23] 9.9670 9.0602 9.8874 0.6565 6.2704 4.9048 9.7102 3.6222 6.7999 2.6372 1.8571
##  [34] 1.8514 3.7930 8.4702 4.9808 7.9059 8.3846 4.5690 7.9948 3.8194 7.5970 4.3678
##  [45] 9.0422 3.1953 0.8257 8.1629 8.9848 9.6650 5.7307 7.2008 7.7406 6.2776 7.2299
##  [56] 3.8683 1.6279 1.8723 3.9125 2.7390 1.9192 5.0439 7.6384 6.9367 5.4405 6.5909
##  [67] 4.6873 4.8181 3.3706 4.2453 2.8702 6.0119 8.4074 6.2084 1.3455 5.6772 4.4343
##  [78] 4.3798 6.2362 9.3265 8.8849 8.7854 2.4218 7.4145 3.8766 0.7895 0.9484 7.6214
##  [89] 3.4789 4.1677 3.4402 0.0841 9.1157 1.8221 7.2280 5.7196 5.4004 3.5495 8.2409
## [100] 1.8614</code></pre>
<p> </p>
<p>Podemos explorar el resultado graficando un histograma:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># crear histograma</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(unif_var), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> unif_var)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-7-1.png" width="672" />
 </p>
<p>Muestra una distribución uniforme que va de 0 a 10.</p>
<p>También podemos simular números aleatorios procedentes de una
distribución normal utilizando <code>rnorm()</code>:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># crear una variable normal</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>norm_var <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># graficar histograma</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(norm_var), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> norm_var)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p> </p>
<p>Tenga en cuenta que todas las funciones generadoras de números
aleatorios tienen el argumento ‘n’, que determina la longitud del vector
generado (es decir, el número de números aleatorios), además de algunos
argumentos adicionales relacionados con parámetros específicos de la
distribución.</p>
<p>Las variables continuas (es decir, los vectores numéricos) pueden
convertirse en variables discretas (es decir, números enteros)
simplemente redondeándolas:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>v1</span></code></pre></div>
<pre><code>## [1] 15.43  8.54 15.14  8.92  9.37</code></pre>
<div class="sourceCode" id="cb9"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">round</span>(<span class="at">x =</span> v1, <span class="at">digits =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 15  9 15  9  9</code></pre>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 1</font></p>
<ul>
<li><p>¿Qué hacen las funciones <code>rbinom()</code> y
<code>rexp()</code>?</p></li>
<li><p>Ejecutela y haga histogramas de sus resultados</p></li>
<li><p>¿Qué hacen los argumentos ‘mean’ y ‘sd’ en <code>rnorm()</code>?
Juege con diferentes valores y comprueba el histograma para hacerse una
idea de su efecto en la simulación</p></li>
</ul>
</div>
<p> </p>
</div>
<div id="generación-de-variables-categóricas" class="section level2">
<h2>Generación de variables categóricas</h2>
<p>La forma más sencilla de generar variables categóricas es utilizar el
vector de ejemplo <code>letters' (o</code>LETTERS’) para asignar niveles
de categoría. Podemos hacerlo utilizando la función <code>rep()</code>.
Por ejemplo, el siguiente código crea un vector categórico (caracteres)
con dos niveles, cada uno con 4 observaciones:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot;</code></pre>
<p> </p>
<p>También podemos replicar este patrón utilizando el argumento ‘times’.
Este código replica el vector anterior 2 veces:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="dv">4</span>, <span class="at">times =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot;</code></pre>
<p> </p>
<p>Otra opción es simular una variable a partir de una distribución
binomial y luego convertirla en un factor:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># correr rbinom</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>binom_var <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">50</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>binom_var</span></code></pre></div>
<pre><code>##  [1] 1 0 0 1 1 0 0 0 0 0 0 0 1 1 1 0 0 1 0 1 0 0 0 0 0 0 0 1 0 1 1 1 0 0 0 1 0 0 1 1 0
## [42] 0 0 0 0 1 0 1 1 1</code></pre>
<div class="sourceCode" id="cb17"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># convertir a factor</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>categ_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(binom_var, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a>categ_var</span></code></pre></div>
<pre><code>##  [1] b a a b b a a a a a a a b b b a a b a b a a a a a a a b a b b b a a a b a a b b a
## [42] a a a a b a b b b
## Levels: a b</code></pre>
<p> </p>
</div>
<div id="muestreo-aleatorio" class="section level2">
<h2>Muestreo aleatorio</h2>
<p>La otra herramienta importante de R para jugar con datos simulados es
<code>sample()</code>. Esta función permite tomar muestras de tamaños
específicos de vectores. Por ejemplo, tomemos el ejemplo del vector
‘letters’:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>letters</span></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot; &quot;r&quot; &quot;s&quot; &quot;t&quot;
## [21] &quot;u&quot; &quot;v&quot; &quot;w&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot;</code></pre>
<p> </p>
<p>Podemos tomar una muestra de este vector como es:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># tomar muestra</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">sample</span>(<span class="at">x =</span> letters, <span class="at">size =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;i&quot; &quot;r&quot; &quot;q&quot; &quot;a&quot; &quot;c&quot; &quot;m&quot; &quot;y&quot; &quot;z&quot; &quot;u&quot; &quot;v&quot;</code></pre>
<p> </p>
<p>El argumento ‘size’ nos permite determinar el tamaño de la muestra.
Tenga en cuenta que obtendremos un error si el tamaño es mayor que el
propio vector:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">sample</span>(<span class="at">x =</span> letters, <span class="at">size =</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>## Error in sample.int(length(x), size, replace, prob): impossível tomar uma amostra maior que a população quando &#39;replace = FALSE&#39;</code></pre>
<p> </p>
<p>Esto sólo puede hacerse cuando el muestreo es con reemplazo
(replacement). El muestreo con reemplazo puede aplicarse estableciendo
el argumento <code>replace = TRUE</code>:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">sample</span>(<span class="at">x =</span> letters, <span class="at">size =</span> <span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;j&quot; &quot;i&quot; &quot;h&quot; &quot;i&quot; &quot;k&quot; &quot;u&quot; &quot;n&quot; &quot;i&quot; &quot;w&quot; &quot;k&quot; &quot;c&quot; &quot;t&quot; &quot;m&quot; &quot;p&quot; &quot;i&quot; &quot;h&quot; &quot;d&quot; &quot;w&quot; &quot;c&quot; &quot;q&quot;
## [21] &quot;j&quot; &quot;e&quot; &quot;e&quot; &quot;j&quot; &quot;k&quot; &quot;c&quot; &quot;l&quot; &quot;t&quot; &quot;r&quot; &quot;h&quot;</code></pre>
<p> </p>
</div>
<div id="iterar-un-proceso" class="section level2">
<h2>Iterar un proceso</h2>
<p>A menudo, las simulaciones deben repetirse varias veces para
descartar resultados espurios debidos al azar o simplemente para probar
diferentes parámetros. Las funciones de simulación de datos mencionadas
anteriormente pueden ejecutarse varias veces (por ejemplo, iteradas)
utilizando la función <code>replicate()</code>:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># replicar</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>repl_rnorm <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="at">n =</span> <span class="dv">3</span>, <span class="at">expr =</span> <span class="fu">rnorm</span>(<span class="dv">2</span>), <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># ver clase</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="fu">class</span>(repl_rnorm)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb29"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># imprimir</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>repl_rnorm</span></code></pre></div>
<pre><code>## [[1]]
## [1]  1.19 -0.34
## 
## [[2]]
## [1]  0.789 -0.632
## 
## [[3]]
## [1] -1.493 -0.134</code></pre>
<p> </p>
</div>
<div id="hacer-que-las-simulaciones-sean-reproducibles"
class="section level2">
<h2>Hacer que las simulaciones sean reproducibles</h2>
<p>El último truco que necesitamos para ejecutar simulaciones en R es la
capacidad de reproducir una simulación (es decir, obtener exactamente
los mismos datos y resultados simulados). Esto puede ser útil para que
otros investigadores puedan ejecutar nuestros análisis exactamente de la
misma manera. Esto puede hacerse fácilmente con la función
<code>set.seed()</code>. Pruebe a ejecutar el siguiente código. Debería
obtener la misma salida:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># definir semilla</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="co"># crear variable uniforme</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.507 0.307</code></pre>
<hr />
</div>
</div>
<div id="crear-juegos-de-datos" class="section level1">
<h1>Crear juegos de datos</h1>
<div id="juegos-de-datos-con-variables-numéricas-y-categóricas"
class="section level2">
<h2>Juegos de datos con variables numéricas y categóricas</h2>
<p>Ahora que sabemos cómo simular variables continuas y categóricas.
Podemos juntarlas para crear conjuntos de datos simulados. Esto se puede
hacer utilizando la función <code>data.frame()</code>:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># crear variable categorica</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>grupo <span class="ot">&lt;-</span> <span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co"># crear variable continuaa</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>size <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="co"># poner juntas en un data frame</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(grupo, size)</span>
<span id="cb33-9"><a href="#cb33-9"></a></span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="co"># imprimir</span></span>
<span id="cb33-11"><a href="#cb33-11"></a>df</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
grupo
</th>
<th style="text-align:center;">
size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
4.82
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
3.63
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
4.40
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
5.29
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
5.39
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
3.79
</td>
</tr>
</tbody>
</table>
<p>Por supuesto, podríamos añadir más variables a este cuadro de
datos:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># crear variable categorica</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>grupo <span class="ot">&lt;-</span> <span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb34-3"><a href="#cb34-3"></a>individuo <span class="ot">&lt;-</span> <span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co"># crear variables continuas</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>size <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb34-7"><a href="#cb34-7"></a>weight <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">mean =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb34-8"><a href="#cb34-8"></a></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co"># poner todo en un data frame</span></span>
<span id="cb34-10"><a href="#cb34-10"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(grupo, individuo, size, weight)</span>
<span id="cb34-11"><a href="#cb34-11"></a></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="co"># imprimir</span></span>
<span id="cb34-13"><a href="#cb34-13"></a>df</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
grupo
</th>
<th style="text-align:center;">
individuo
</th>
<th style="text-align:center;">
size
</th>
<th style="text-align:center;">
weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
4.64
</td>
<td style="text-align:center;">
109.9
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
3.37
</td>
<td style="text-align:center;">
107.4
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
4.74
</td>
<td style="text-align:center;">
100.9
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
6.10
</td>
<td style="text-align:center;">
90.5
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
E
</td>
<td style="text-align:center;">
5.76
</td>
<td style="text-align:center;">
98.0
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
F
</td>
<td style="text-align:center;">
4.76
</td>
<td style="text-align:center;">
109.3
</td>
</tr>
</tbody>
</table>
<p>Y eso es un juego de datos simulados en su forma más básica. Se
parece mucho al tipo de datos con los que trabajamos en biología.</p>
<hr />
</div>
</div>
<div
id="cómo-utilizar-datos-simulados-para-entender-el-comportamiento-de-las-herramientas-estadísticas"
class="section level1">
<h1>Cómo utilizar datos simulados para entender el comportamiento de las
herramientas estadísticas</h1>
<p> </p>
<div id="prueba-de-concepto-el-teorema-central-del-límite"
class="section level2">
<h2>Prueba de concepto: <em>el Teorema Central del Límite</em></h2>
<p>El <a
href="https://en.wikipedia.org/wiki/Central_limit_theorem">Teorema del
Límite Central</a> afirma que, si tomamos muestras aleatorias de una
población, los promedios de esas muestras seguirán una distribución
normal, aunque la población no esté distribuida normalmente. Además, la
distribución normal resultante debe tener un promedio cercano al
promedio de la población. El teorema es un concepto clave para la
estadística inferencial, ya que implica que los métodos estadísticos que
funcionan para las distribuciones normales pueden ser aplicables a
muchos problemas que implican otros tipos de distribuciones. No
obstante, el objetivo aquí es sólo mostrar cómo se pueden utilizar las
simulaciones para entender el comportamiento de los métodos
estadísticos.</p>
<p>Para comprobar si esas afirmaciones básicas sobre el Teorema del
Límite Central son ciertas, podemos utilizar datos simulados en R. Vamos
a simular una población de 1000 observaciones con una distribución
uniforme:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># simular popublacion uniforme</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>unif_pop <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># ver histograma</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(unif_pop), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> unif_pop)) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>    <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p> </p>
<p>Podemos tomar muestras aleatorias usando <code>sample()</code>
así:</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">sample</span>(<span class="at">x =</span> unif_pop, <span class="at">size =</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>##  [1] 9.284 1.026 2.575 3.325 6.900 2.294 0.337 8.214 3.304 8.038 2.592 7.818 5.654
## [14] 0.638 2.835 4.204 4.763 4.422 6.978 7.926 0.681 3.523 6.511 5.383 7.972 1.801
## [27] 4.213 3.339 8.912 4.712</code></pre>
<p> </p>
<p>Este proceso puede ser replicado varias veces con
<code>replicate()</code>:</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># replicar</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>samples <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">expr =</span> <span class="fu">mean</span>(<span class="fu">sample</span>(<span class="at">x =</span> unif_pop, <span class="at">size =</span> <span class="dv">30</span>)))</span></code></pre></div>
<p> </p>
<p>El código anterior toma 100 muestras con 30 valores cada una. Ahora
podemos comprobar la distribución de las muestras:</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># ver distribucion/ histograma</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(samples), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> samples)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-27-1.png" width="672" />
 </p>
<p>… asi como el promedio:</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">mean</span>(samples)</span></code></pre></div>
<pre><code>## [1] 5.02</code></pre>
<p> </p>
<p>Como era de esperar, las muestras siguen una distribución normal con
una media cercana a la media de la población, que es:</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">mean</span>(unif_pop)</span></code></pre></div>
<pre><code>## [1] 5.05</code></pre>
<p> </p>
<p>Probemos con una distribución más compleja. Por ejemplo, una
distribución bimodal:</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># usar semilla</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb44-3"><a href="#cb44-3"></a></span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="co"># simular variables</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>norm1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb44-6"><a href="#cb44-6"></a>norm2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb44-7"><a href="#cb44-7"></a></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="co"># juntar en una sola variable</span></span>
<span id="cb44-9"><a href="#cb44-9"></a>bimod_pop <span class="ot">&lt;-</span> <span class="fu">c</span>(norm1, norm2)</span>
<span id="cb44-10"><a href="#cb44-10"></a></span>
<span id="cb44-11"><a href="#cb44-11"></a><span class="co"># ver histograma</span></span>
<span id="cb44-12"><a href="#cb44-12"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(bimod_pop), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> bimod_pop)) <span class="sc">+</span></span>
<span id="cb44-13"><a href="#cb44-13"></a>    <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># replicar muestreo</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>samples <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">200</span>, <span class="fu">mean</span>(<span class="fu">sample</span>(bimod_pop, <span class="dv">10</span>)))</span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="co"># ver histograma</span></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(samples), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> samples)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># ver promedios</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">mean</span>(samples)</span></code></pre></div>
<pre><code>## [1] 15.2</code></pre>
<div class="sourceCode" id="cb48"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">mean</span>(bimod_pop)</span></code></pre></div>
<pre><code>## [1] 15.1</code></pre>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 2</font></p>
<p> </p>
<ul>
<li><p>Intenta explorar el Teorema del Límite Central como en el caso
anterior, pero esta vez utilizando:</p>
<ol style="list-style-type: decimal">
<li>Una distribución exponencial (<code>rexp()</code>)</li>
<li>Una distribución binomial (<code>rbinom()</code>)</li>
</ol></li>
</ul>
<p> </p>
<ul>
<li>Para cada distribución: grafique un histograma y compare los
promedios de la población y de las muestras</li>
</ul>
</div>
<p> </p>
<hr />
<div class="alert alert-warning">
<font size = 6>
<center>
Regresión lineal simple
</center>
<p></font></p>
<p>Las regresiones lineales se basan en la ecuación lineal <em>a = mx +
b</em> que aprendimos en el colegio. La representación formal tiene este
aspecto:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim \beta_{o} +
\beta_{1} * x_{1}\)</span></font>
</center>
<p> </p>
<ul>
<li><p><span class="math inline">\(\hat{Y}\)</span>: variable
respuesta</p></li>
<li><p><span class="math inline">\(\beta_{o}\)</span>:
intercepto</p></li>
<li><p><span class="math inline">\(\beta_{1}\)</span>: estimado de la
magnitud del efecto de <span class="math inline">\(x_{1}\)</span> en
<span class="math inline">\(\hat{Y}\)</span> (también conocido como
tamaño de efecto, coeficiente o simplemente “estimado”)</p></li>
<li><p><span class="math inline">\(x_{1}\)</span>: variable
predictora</p></li>
</ul>
<p> </p>
<p>El objetivo más común de una regresión lineal es la estimación de los
valores de <span class="math inline">\(\beta_{*}\)</span>. Esto se
consigue encontrando la línea recta que mejor se ajusta y que representa
la asociación entre un predictor y la respuesta:</p>
<p><img src="images/regression.jpg" width="100%" style="display: block; margin: auto;" />
 </p>
<p>Estos <span class="math inline">\(\beta_{*}\)</span> son el tamaño de
efecto estimado del predictor correspondiente (por ejemplo, <span
class="math inline">\(\beta_{1}\)</span> es el tamaño de efecto <span
class="math inline">\(x_{1}\)</span>). Su valor representa el cambio
medio en <span class="math inline">\(\hat{Y}\)</span> (en unidades <span
class="math inline">\(\hat{Y}\)</span>) para una unidad de cambio en
<span class="math inline">\(\beta_{*}\)</span>. Por lo tanto, la
hipótesis nula es que esos <span
class="math inline">\(\beta_{*}\)</span> no son diferentes de 0:</p>
<center>
<font size = 6><span class="math inline">\(\qquad \mathcal{H}_0: \hat{Y}
= \beta_0 + 0 * x_{1}\)</span></font>
</center>
<p>lo que equivale a esto:</p>
<center>
<font size = 6><span class="math inline">\(\qquad \mathcal{H}_0: \hat{Y}
= \beta_0\)</span></font>
</center>
<p> </p>
<p>Por ejemplo, un modelo de regresión con este resultado:</p>
<p><img src="images/model_betas_esp.png" width="90%" style="display: block; margin: auto;" /></p>
<p> </p>
</div>
<p> </p>
<hr />
</div>
</div>
<div id="regresión-lineal-en-r" class="section level1">
<h1>Regresión lineal en R</h1>
<p>Para sacar el máximo provecho de los modelos lineales necesitamos
sentirnos cómodos con ellos. Empezaremos explorando la función de
regresión lineal de R <code>lm()</code>. En R la mayoría de los modelos
lineales y sus extensiones comparten formatos comunes de entrada de
datos y resultados, lo que facilita su aplicación una vez que entendemos
sus fundamentos.</p>
<p>Utilizaremos el juego de datos ‘trees’ que viene por defecto con R.
‘trees’ proporciona medidas del <strong>diámetro</strong> (etiquetado
como ‘Girth’), <strong>altura</strong> y <strong>volumen</strong> de 31
cerezos talados:</p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="fu">head</span>(trees)</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Girth
</th>
<th style="text-align:center;">
Height
</th>
<th style="text-align:center;">
Volume
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
8.3
</td>
<td style="text-align:center;">
70
</td>
<td style="text-align:center;">
10.3
</td>
</tr>
<tr>
<td style="text-align:center;">
8.6
</td>
<td style="text-align:center;">
65
</td>
<td style="text-align:center;">
10.3
</td>
</tr>
<tr>
<td style="text-align:center;">
8.8
</td>
<td style="text-align:center;">
63
</td>
<td style="text-align:center;">
10.2
</td>
</tr>
<tr>
<td style="text-align:center;">
10.5
</td>
<td style="text-align:center;">
72
</td>
<td style="text-align:center;">
16.4
</td>
</tr>
<tr>
<td style="text-align:center;">
10.7
</td>
<td style="text-align:center;">
81
</td>
<td style="text-align:center;">
18.8
</td>
</tr>
<tr>
<td style="text-align:center;">
10.8
</td>
<td style="text-align:center;">
83
</td>
<td style="text-align:center;">
19.7
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>La función básica de R para construir un modelo lineal es
<code>lm()</code>. Veamos los componentes básicos de un modelo de
regresión utilizando <code>lm()</code>:</p>
<p><img src="images/lm.png" width="100%" style="display: block; margin: auto;" />
 </p>
<p>Podemos correr este modelo para ver el resultado:</p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>reg_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> Height <span class="sc">~</span> Girth, <span class="at">data =</span> trees)</span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="fu">summary</span>(reg_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Height ~ Girth, data = trees)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -12.582  -2.769   0.316   2.473   9.946 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   62.031      4.383   14.15  1.5e-14 ***
## Girth          1.054      0.322    3.27   0.0028 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.54 on 29 degrees of freedom
## Multiple R-squared:  0.27,   Adjusted R-squared:  0.244 
## F-statistic: 10.7 on 1 and 29 DF,  p-value: 0.00276</code></pre>
<p> </p>
<p>Esto es lo que significan los elementos de la salida:</p>
<ul>
<li><p><strong>Llamada</strong> (call): la función y los parámetros que
se utilizaron para crear el modelo</p></li>
<li><p><strong>Residuales</strong> (residuals): distribución de los
residuales. Los residuales son la diferencia entre lo que predijo el
modelo y el valor real de <em>y</em>. Esta es una representación gráfica
de los residuales:</p></li>
</ul>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-41-1.png" width="672" />
 </p>
<ul>
<li><p><strong>Coeficientes</strong> (coefficients): contiene los
tamaños de efecto (‘Estimates’), una medida de su incertidumbre
(‘Standar error’), la estadística asociada (‘t value’) y el valor p
(‘Pr(&gt;|t|)’). Los tamaño de efecto o estimados se dan como el cambio
promedio en <em>y</em> por cada aumento de 1 unidad en <em>x</em>. Para
este ejemplo el estimado es de 1,0544 <span class="math inline">\(in /
in\)</span>. A pesar de que las unidades se anulan (`1,0544 <span
class="math inline">\(in / in\)</span> = 1,0544) tenerlas en cuenta
sigue siendo biológicamente significativo. Significan que, en promedio,
y un aumento de 1 pulgada en la circunferencia que se espera un aumento
de 1,0544 pulgadas en la altura.</p></li>
<li><p><strong>Error estándar de los residuales</strong> (residual
standard error): se explica por sí mismo. El error estándar de los
residuales</p></li>
<li><p><strong>R-cuadrado múltiple</strong> (multiple R-squared): el
coeficiente de determinación, que pretende ser una medida de lo bien que
su modelo se ajusta a los datos</p></li>
<li><p><strong>R-cuadrado ajustado</strong> (adjusted R-squared):
similar al ‘R-cuadrado múltiple’ pero penalizado por el número de
parámetros</p></li>
<li><p><strong>Estadístico F</strong> (F-statistic): estadístico para
una prueba global que comprueba si al menos uno de sus coeficientes es
distinto de cero</p></li>
<li><p><strong>Valor de p</strong>: probabilidad de una prueba global
que comprueba si al menos uno de sus coeficientes es distinto de
cero</p></li>
</ul>
<p> </p>
<p>Utilizaremos <code>lm()</code> para mostrar la flexibilidad de los
modelos de regresión. Los componentes de regresión se añadirán
gradualmente para que podamos tomarnos el tiempo de entender cada uno de
ellos así como los correspondientes cambios en la salida de la
regresión.</p>
<hr />
<div id="modelo-solo-con-intercepto" class="section level2">
<h2>Modelo solo con intercepto</h2>
<p>Primero vamos a crear una variable numérica de respuesta:</p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># definir semilla</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb53-3"><a href="#cb53-3"></a></span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb53-6"><a href="#cb53-6"></a></span>
<span id="cb53-7"><a href="#cb53-7"></a><span class="co"># variables aleatorias</span></span>
<span id="cb53-8"><a href="#cb53-8"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb53-9"><a href="#cb53-9"></a></span>
<span id="cb53-10"><a href="#cb53-10"></a><span class="co"># put it in a data frame</span></span>
<span id="cb53-11"><a href="#cb53-11"></a>y_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y)</span></code></pre></div>
<p> </p>
<p>Esta única variable puede introducirse en un <strong>modelo de
regresión sólo con intercepto</strong>. Para ello, debemos suministrar
la fórmula del modelo y los datos a <code>lm()</code>:</p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># run model</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> y_data)</span></code></pre></div>
<p> </p>
<p>Lo que equivale a:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim
\beta_{o}\)</span></font>
</center>
<p> </p>
<p>Podemos obtener el resumen por defecto de los resultados del modelo
ejecutando <code>summary()</code> en el objeto de salida ‘y_mod’:</p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">summary</span>(y_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ 1, data = y_data)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -2.001 -0.594 -0.107  0.664  2.135 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)   0.0344     0.1309    0.26     0.79
## 
## Residual standard error: 0.926 on 49 degrees of freedom</code></pre>
<p> </p>
<p>Puede ser bastante informativo graficar los tamaños de efecto (aunque
en este caso sólo tenemos uno):</p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(y_mod<span class="sc">$</span>coefficients), <span class="at">est =</span> y_mod<span class="sc">$</span>coefficients,</span>
<span id="cb57-2"><a href="#cb57-2"></a>    <span class="fu">confint</span>(y_mod))</span>
<span id="cb57-3"><a href="#cb57-3"></a></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb57-5"><a href="#cb57-5"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parámetro&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Tamaño de efecto&quot;</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-45-1.png" width="672" />
 </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Para evaluar la importancia de la asociación nos centramos en la
tabla de coeficientes:</p>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)   0.0344      0.131   0.263    0.794</code></pre>
<ul>
<li><p>En este ejemplo no hay predictores en el modelo, por lo que sólo
tenemos una estimación para el intercepto (<span
class="math inline">\(\beta_0\)</span>)</p></li>
<li><p>El modelo nos dice que el intercepto se estima en 0.034 y que
este valor no es significativamente diferente de 0 (valor p =
0.794)</p></li>
<li><p>En este caso el intercepto es simplemente la media de la variable
de respuesta</p></li>
</ul>
<div class="sourceCode" id="cb59"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="fu">mean</span>(y_data<span class="sc">$</span>y)</span></code></pre></div>
<pre><code>## [1] 0.0344</code></pre>
<p> </p>
<ul>
<li>Rara vez tenemos predicciones sobre el intercepto, por lo que
tendemos a ignorar esta estimación.</li>
</ul>
</div>
<p> </p>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<p> </p>
<ul>
<li>Ruhs, E. C., Martin, L. B., &amp; Downs, C. J. (2020). <a
href="https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2020.0655?download=true"><strong>The
impacts of body mass on immune cell concentrations in
birds</strong></a>. <em>Proceedings of the Royal Society B</em>,
287(1934), 20200655.</li>
</ul>
<p>“<em>Encontramos que un modelo sólo con intercepto (intercept-only
model) explicaba mejor las concentraciones de linfocitos y eosinófilos
en las aves, indicando que las concentraciones de estos tipos de células
eran independientes de la masa corporal.</em>”</p>
<p><img src="images/leukocytes.png" width="85%" style="display: block; margin: auto;" />
 </p>
</div>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 3</font></p>
<p> </p>
<ul>
<li><p>Cambie el argumento ‘mean’ en la llamada de la función “rnorm()`
(<a href="#cb53-8">línea 130</a>) por un valor distinto de 0 y observe
cómo cambian los valores en la tabla de coeficientes</p></li>
<li><p>Cambia el argumento <code>sd</code> en la llamada a la función
<code>rnorm()</code> (<a href="#cb53-8">línea 130</a>) por un valor más
alto y observe cómo cambian los valores en la tabla de
coeficientes</p></li>
</ul>
</div>
<p> </p>
<hr />
</div>
<div id="añadir-un-predictor-no-asociado" class="section level2">
<h2>Añadir un predictor no asociado</h2>
<p>Podemos crear 2 variables numéricas no relacionadas así:</p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># definir semilla</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb61-6"><a href="#cb61-6"></a></span>
<span id="cb61-7"><a href="#cb61-7"></a><span class="co"># variables aleatorias</span></span>
<span id="cb61-8"><a href="#cb61-8"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb61-9"><a href="#cb61-9"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb61-10"><a href="#cb61-10"></a></span>
<span id="cb61-11"><a href="#cb61-11"></a><span class="co"># crear data frame</span></span>
<span id="cb61-12"><a href="#cb61-12"></a>xy_datos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y)</span></code></pre></div>
<p> </p>
<p>Estas dos variables pueden introducirse en un modelo de regresión
para evaluar la asociación entre ellas:</p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># construir model</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>xy_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_datos)</span>
<span id="cb62-3"><a href="#cb62-3"></a></span>
<span id="cb62-4"><a href="#cb62-4"></a><span class="co"># graficar</span></span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="fu">ggplot</span>(xy_datos, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb62-6"><a href="#cb62-6"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">geom_point</span>()  <span class="co"># graficar points</span></span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-50-1.png" width="672" />
 </p>
<p>Que es equivalente a esto:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim \beta_{o} +
\beta_{1} * x_{1}\)</span></font>
</center>
<p> </p>
<p>Imprimamos el resumen de este modelo:</p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="fu">summary</span>(xy_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1, data = xy_datos)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -2.004 -0.624 -0.123  0.687  2.106 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)   0.0398     0.1340    0.30     0.77
## x1           -0.0367     0.1475   -0.25     0.80
## 
## Residual standard error: 0.935 on 48 degrees of freedom
## Multiple R-squared:  0.00129,    Adjusted R-squared:  -0.0195 
## F-statistic: 0.0618 on 1 and 48 DF,  p-value: 0.805</code></pre>
<p> </p>
<p>… y graficar los tamaños de efecto:</p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod<span class="sc">$</span>coefficients), <span class="at">est =</span> xy_mod<span class="sc">$</span>coefficients,</span>
<span id="cb65-2"><a href="#cb65-2"></a>    <span class="fu">confint</span>(xy_mod))</span>
<span id="cb65-3"><a href="#cb65-3"></a></span>
<span id="cb65-4"><a href="#cb65-4"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb65-5"><a href="#cb65-5"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parámetro&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Tamaño de efecto&quot;</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-52-1.png" width="672" />
 </p>
<p>Deberíamos “diagnosticar” la idoneidad del modelo inspeccionando más
de cerca la distribución de los residuales. La función
<code>plot_model()</code> del paquete <code>sjPlot</code> hace un buen
trabajo para crear gráficos de diagnóstico para modelos lineales:</p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">plot_model</span>(xy_mod, <span class="at">type =</span> <span class="st">&quot;diag&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-53-1.png" width="80%" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-53-2.png" width="80%" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-53-3.png" width="80%" />
 </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Cuadro con coeficientes:</p>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)   0.0398      0.134   0.297    0.768
## x1           -0.0367      0.147  -0.249    0.805</code></pre>
<p> </p>
<ul>
<li><p>En este ejemplo hemos añadido un predictor al modelo, por lo que
hemos obtenido una estimado adicional (y una fila extra, ‘x1’)</p></li>
<li><p>El modelo nos dice que la estimación de ‘x1’ es -0.037 y que no
es significativamente diferente de 0 (p = 0.805)</p></li>
</ul>
</div>
<hr />
<p> </p>
</div>
<div id="simular-un-predictor-asociado" class="section level2">
<h2>Simular un predictor asociado</h2>
<p>Podemos utilizar la fórmula del modelo lineal anterior para simular
dos variables continuas asociadas así:</p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># definir semilla</span></span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb71-3"><a href="#cb71-3"></a></span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb71-5"><a href="#cb71-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb71-6"><a href="#cb71-6"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb71-7"><a href="#cb71-7"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb71-8"><a href="#cb71-8"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb71-9"><a href="#cb71-9"></a></span>
<span id="cb71-10"><a href="#cb71-10"></a><span class="co"># variables aleatorias</span></span>
<span id="cb71-11"><a href="#cb71-11"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb71-12"><a href="#cb71-12"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> error</span>
<span id="cb71-13"><a href="#cb71-13"></a></span>
<span id="cb71-14"><a href="#cb71-14"></a><span class="co"># crear data frame</span></span>
<span id="cb71-15"><a href="#cb71-15"></a>xy_datos2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y)</span></code></pre></div>
<p> </p>
<p>Note que <strong>también hemos añadido un término de error</strong>,
por lo que la asociación no es perfecta. Vamos a correr el modelo y
graficar la asociación entre las dos variables:</p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># construir model</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>xy_mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_datos2)</span>
<span id="cb72-3"><a href="#cb72-3"></a></span>
<span id="cb72-4"><a href="#cb72-4"></a><span class="co"># graficar</span></span>
<span id="cb72-5"><a href="#cb72-5"></a><span class="fu">ggplot</span>(xy_datos2, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb72-6"><a href="#cb72-6"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">geom_point</span>()  <span class="co"># graficar points</span></span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-56-1.png" width="672" />
 </p>
<p>La fórmula es la misma que la del modelo anterior:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim \beta_{o} +
\beta_{1} * x_{1}\)</span></font>
</center>
<p> </p>
<p>Este es el resumen del modelo:</p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="fu">summary</span>(xy_mod2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1, data = xy_datos2)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -6.01  -1.87  -0.37   2.06   6.32 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -3.881      0.402   -9.66  7.9e-13 ***
## x1             2.890      0.442    6.53  3.9e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.8 on 48 degrees of freedom
## Multiple R-squared:  0.471,  Adjusted R-squared:  0.459 
## F-statistic: 42.7 on 1 and 48 DF,  p-value: 3.85e-08</code></pre>
<p> </p>
<p>.. el gráfico con los tamaños de efecto:</p>
<div class="sourceCode" id="cb75"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod2<span class="sc">$</span>coefficients), <span class="at">est =</span> xy_mod2<span class="sc">$</span>coefficients,</span>
<span id="cb75-2"><a href="#cb75-2"></a>    <span class="fu">confint</span>(xy_mod2))</span>
<span id="cb75-3"><a href="#cb75-3"></a></span>
<span id="cb75-4"><a href="#cb75-4"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb75-5"><a href="#cb75-5"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parámetro&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Tamaño de efecto&quot;</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-58-1.png" width="672" />
 </p>
<p>… y los gráficos diagnósticos del modelo:</p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="fu">plot_model</span>(xy_mod2, <span class="at">type =</span> <span class="st">&quot;diag&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-59-1.png" width="80%" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-59-2.png" width="80%" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-59-3.png" width="80%" />
 </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Cuadro con los coeficientes (estimados):</p>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    -3.88      0.402   -9.66 7.86e-13
## x1              2.89      0.442    6.53 3.85e-08</code></pre>
<ul>
<li><p>El modelo nos dice que <span
class="math inline">\(beta_1\)</span> (el tamaño de efecto de ‘x1’) es
2.89 y que es significativamente diferente de 0 (p =
3.854^{-8})</p></li>
<li><p>Los valores simulados de los parámetros de regresión pueden
compararse con el resumen del modelo <code>lm()</code> para tener una
idea de la precisión del modelo:</p>
<ul>
<li><span class="math inline">\(\beta_1\)</span> (the effect size of
‘x1’) was set to 3 and was estimated as 2.89 by the model</li>
</ul></li>
</ul>
</div>
<p> </p>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<p> </p>
<ul>
<li>Keenan EL, Odom KJ, Araya-Salas M, Horton KG, Strimas-Mackey M,
Meatte MA, Mann NI, Slater PJ, Price JJ, and Templeton CN. 2020. <a
href="https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2020.2482"><strong>Breeding
season length predicts duet coordination and consistency in Neotropical
wrens (Troglodytidae)</strong></a>. <em>Proceeding of the Royal Society
B</em>. 20202482</li>
</ul>
<p><img src="images/duets.png" width="100%" style="display: block; margin: auto;" />
 </p>
<p>“<em>… la coordinación y la consistencia de los duetos son mayores en
las especies con temporadas de apareamiento especialmente
largas.</em>”</p>
<p><img src="images/duet_reg.png" width="70%" style="display: block; margin: auto;" />
 </p>
</div>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 4</font></p>
<p> </p>
<ul>
<li><p>Aumente el tamaño de la muestra (<code>n</code>) a 1000 o
más</p></li>
<li><p>¿Cómo cambiaron los estimados del tamaño de efecto (<span
class="math inline">\(\beta\)</span>)?</p></li>
<li><p>¿Cómo cambió el error estándar del tamaño de efecto?</p></li>
<li><p>Ahora cambie <code>n</code> a 15 y compruebe de nuevo las
estimaciones del modelo (esta vez compruebe también el valor p)</p></li>
</ul>
</div>
<p> </p>
<hr />
</div>
<div id="varios-predictores-regresión-múltiple" class="section level2">
<h2>Varios predictores: regresión múltiple</h2>
<p>La regresión lineal múltiple es una extensión del modelo de regresión
lineal simple que puede tomar varios predictores:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim \beta_{o} +
\beta_{1} * x_{1} + \cdots + \beta_{n} * x_{n}\)</span></font>
</center>
<p> </p>
<p>La fórmula parece compleja, pero sólo quiere decir que cualquier
parámetro adicional tendrá su propia estimación (<span
class="math inline">\(\beta\)</span>). La fórmula para una regresión
lineal de dos predictores se ve así:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim \beta_{o} +
\beta_{1} * x_{1} + \beta_{2} * x_{2}\)</span></font>
</center>
<p> </p>
<p>… y se puede simular así:</p>
<div class="sourceCode" id="cb81"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># semila</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb81-3"><a href="#cb81-3"></a></span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb81-5"><a href="#cb81-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb81-6"><a href="#cb81-6"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb81-7"><a href="#cb81-7"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb81-8"><a href="#cb81-8"></a>b2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb81-9"><a href="#cb81-9"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb81-10"><a href="#cb81-10"></a></span>
<span id="cb81-11"><a href="#cb81-11"></a><span class="co"># variables aleatorias</span></span>
<span id="cb81-12"><a href="#cb81-12"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb81-13"><a href="#cb81-13"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb81-14"><a href="#cb81-14"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb81-15"><a href="#cb81-15"></a></span>
<span id="cb81-16"><a href="#cb81-16"></a><span class="co"># crear un data frame</span></span>
<span id="cb81-17"><a href="#cb81-17"></a>xy_datos_multp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb81-18"><a href="#cb81-18"></a></span>
<span id="cb81-19"><a href="#cb81-19"></a><span class="co"># construir el modelo</span></span>
<span id="cb81-20"><a href="#cb81-20"></a>xy_mod_multp <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_datos_multp)</span>
<span id="cb81-21"><a href="#cb81-21"></a></span>
<span id="cb81-22"><a href="#cb81-22"></a><span class="fu">summary</span>(xy_mod_multp)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2, data = xy_datos_multp)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -5.986 -1.893 -0.363  2.002  6.413 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -3.865      0.417   -9.27  3.5e-12 ***
## x1             2.901      0.453    6.41  6.4e-08 ***
## x2            -1.932      0.414   -4.67  2.6e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.83 on 47 degrees of freedom
## Multiple R-squared:  0.612,  Adjusted R-squared:  0.595 
## F-statistic:   37 on 2 and 47 DF,  p-value: 2.23e-10</code></pre>
<p> </p>
<p>… graficar los tamaños de efecto:</p>
<div class="sourceCode" id="cb83"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_multp<span class="sc">$</span>coefficients), <span class="at">est =</span> xy_mod_multp<span class="sc">$</span>coefficients,</span>
<span id="cb83-2"><a href="#cb83-2"></a>    <span class="fu">confint</span>(xy_mod_multp))</span>
<span id="cb83-3"><a href="#cb83-3"></a></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb83-5"><a href="#cb83-5"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parámetro&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Tamaño de efecto&quot;</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-64-1.png" width="672" />
 </p>
<p>… y los gráficos diagnósticos:</p>
<div class="sourceCode" id="cb84"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="fu">plot_model</span>(xy_mod_multp, <span class="at">type =</span> <span class="st">&quot;diag&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-65-1.png" width="80%" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-65-2.png" width="80%" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-65-3.png" width="80%" />
 </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Cuadro con los coeficientes (estimados):</p>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    -3.87      0.417   -9.27 3.49e-12
## x1              2.90      0.453    6.41 6.41e-08
## x2             -1.93      0.414   -4.67 2.59e-05</code></pre>
<ul>
<li><p>El modelo encontró que <span
class="math inline">\(\beta_1\)</span> (el tamaño de efecto de ‘x1’) es
2.901 y que es significativamente diferente de 0 (p = 6.414^{-8}). Este
es el efecto de ‘x1’ sobre ‘y’ una vez removida la variación explicada
por ‘x2’.</p></li>
<li><p>También se encontró que el <span
class="math inline">\(\beta_2\)</span> (el tamaño de efecto de ‘x2’) es
-1.932 y que también es significativamente diferente de 0 (p =
2.585^{-5}). Este es el efecto de ‘x2’ sobre ‘y’ una vez removida la
variación explicada por ‘x1’.</p></li>
<li><p>Los valores simulados de los parámetros de regresión pueden
compararse con el resumen del modelo <code>lm()</code> para tener una
idea de la precisión del modelo:</p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> se fijó en 3 y se
estimó como 2.901.</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> (el tamaño de efecto
de ‘x2’) se fijó en -2 y se estimó como -1.932.</p></li>
</ul></li>
</ul>
</div>
<p> </p>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<p> </p>
<ul>
<li>Araya-Salas M, P González-Gómez, K Wojczulanis-Jakubas, V López III
&amp; T Wright. 2018. <a
href="https://www.nature.com/articles/s41598-018-20441-x"><strong>Spatial
memory is as important as weapon and body size for territorial ownership
in a lekking hummingbird</strong></a>. <em>Scientific Reports</em>. 13,
e0189969</li>
</ul>
<p>“<em>La memoria espacial, el tamaño corporal y el largo de la punta
del pico … predijeron positivamente la probabilidad de adquirir y
defender un territorio.</em>”</p>
<p><img src="images/lbh_cognition.png" width="100%" style="display: block; margin: auto;" />
 </p>
</div>
<p> </p>
<p>Hay un punto importante que es necesario enfatizar aquí: <strong>la
regresión múltiple estima el efecto de un predictor después de tener en
cuenta el efecto de los demás predictores del modelo</strong>. En otras
palabras, los nuevos predictores del modelo tratarán de explicar la
variación de los datos que no fue explicada por los otros predictores.
Así que <strong>el resultado de la regresión múltiple no es equivalente
a los resultados de las regresiones lineales simples</strong> sobre los
mismos predictores. Esto puede demostrarse fácilmente corriendo esas
regresiones:</p>
<div class="sourceCode" id="cb89"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># construir modelos</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>x1y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_datos)</span>
<span id="cb89-3"><a href="#cb89-3"></a>x2y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x2, <span class="at">data =</span> xy_datos)</span>
<span id="cb89-4"><a href="#cb89-4"></a></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="co"># atajo a los coeficientes</span></span>
<span id="cb89-6"><a href="#cb89-6"></a><span class="fu">coef</span>(xy_mod)</span></code></pre></div>
<pre><code>## (Intercept)          x1 
##      0.0398     -0.0367</code></pre>
<div class="sourceCode" id="cb91"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">coef</span>(x1y_mod)</span></code></pre></div>
<pre><code>## (Intercept)          x1 
##      0.0398     -0.0367</code></pre>
<div class="sourceCode" id="cb93"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="fu">coef</span>(x2y_mod)</span></code></pre></div>
<pre><code>## (Intercept)          x2 
##      0.0413      0.0272</code></pre>
<p> </p>
<p>Las estimaciones de las mismas variables varían considerablemente
entre la regresión múltiple y las regresiones de un solo predictor.</p>
<p>Este punto se demuestra además por el hecho de que, si uno de los
predictores no tiene ninguna influencia en la respuesta, el efecto del
predictor adicional convergerá a su efecto en una regresión lineal
simple. Para simular este escenario, fijamos b2 en 0:</p>
<div class="sourceCode" id="cb95"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># definir semilla</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb95-3"><a href="#cb95-3"></a></span>
<span id="cb95-4"><a href="#cb95-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb95-5"><a href="#cb95-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb95-6"><a href="#cb95-6"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb95-7"><a href="#cb95-7"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb95-8"><a href="#cb95-8"></a>b2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb95-9"><a href="#cb95-9"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb95-10"><a href="#cb95-10"></a></span>
<span id="cb95-11"><a href="#cb95-11"></a><span class="co"># variables aleatorias</span></span>
<span id="cb95-12"><a href="#cb95-12"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb95-13"><a href="#cb95-13"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb95-14"><a href="#cb95-14"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb95-15"><a href="#cb95-15"></a></span>
<span id="cb95-16"><a href="#cb95-16"></a><span class="co"># crear data frame</span></span>
<span id="cb95-17"><a href="#cb95-17"></a>xy_datos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb95-18"><a href="#cb95-18"></a></span>
<span id="cb95-19"><a href="#cb95-19"></a><span class="co"># construir modelos</span></span>
<span id="cb95-20"><a href="#cb95-20"></a>xy_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_datos)</span>
<span id="cb95-21"><a href="#cb95-21"></a>x1y_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_datos)</span>
<span id="cb95-22"><a href="#cb95-22"></a></span>
<span id="cb95-23"><a href="#cb95-23"></a><span class="co"># shortcut to coefficients</span></span>
<span id="cb95-24"><a href="#cb95-24"></a><span class="fu">coef</span>(xy_mod)</span></code></pre></div>
<pre><code>## (Intercept)          x1          x2 
##     -3.9551      2.9672      0.0225</code></pre>
<div class="sourceCode" id="cb97"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">coef</span>(x1y_mod)</span></code></pre></div>
<pre><code>## (Intercept)          x1 
##       -3.96        2.96</code></pre>
<p>El estimado de <span class="math inline">\(\beta_1\)</span> fue casi
el mismo en la regresión múltiple (2.967) y en la regresión de un solo
predictor (2.963)</p>
<p>Por comodidad, hemos utilizado <code>coef()</code> para extraer sólo
los estimado de la regresión, pero los valores son los mismos que
obtenemos con <code>summary(model)</code>.</p>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 5</font></p>
<p> </p>
<p>La siguiente simulación genera un par de predictores continuos
altamente colineales:</p>
<div class="sourceCode" id="cb99"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># definir semilla</span></span>
<span id="cb99-2"><a href="#cb99-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb99-3"><a href="#cb99-3"></a></span>
<span id="cb99-4"><a href="#cb99-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb99-5"><a href="#cb99-5"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb99-6"><a href="#cb99-6"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb99-7"><a href="#cb99-7"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb99-8"><a href="#cb99-8"></a>b2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb99-9"><a href="#cb99-9"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb99-10"><a href="#cb99-10"></a></span>
<span id="cb99-11"><a href="#cb99-11"></a><span class="co"># variables aleatorias colineales</span></span>
<span id="cb99-12"><a href="#cb99-12"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb99-13"><a href="#cb99-13"></a>x2 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)  <span class="co"># hacer x2 colineal con x1</span></span>
<span id="cb99-14"><a href="#cb99-14"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb99-15"><a href="#cb99-15"></a></span>
<span id="cb99-16"><a href="#cb99-16"></a><span class="co"># crear data frame</span></span>
<span id="cb99-17"><a href="#cb99-17"></a>xy_datos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb99-18"><a href="#cb99-18"></a></span>
<span id="cb99-19"><a href="#cb99-19"></a><span class="fu">cor</span>(x1, x2)</span></code></pre></div>
<pre><code>## [1] 0.978</code></pre>
<div class="sourceCode" id="cb101"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># graficar</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_datos, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2)) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<ul>
<li><p>Construya un modelo lineal multiple (con <code>lm()</code>) con
‘y’ como respuesta y ‘x1’ y ‘x2’ como predictores</p></li>
<li><p>Compare los betas estimados por el modelo con los usados para
generar los datos. ¿Es una buena estimación?. También observe los
valores de p. ¿Esperaría que fueran significativos?</p></li>
</ul>
</div>
<p> </p>
<hr />
</div>
<div id="añadir-un-predictor-categórico" class="section level2">
<h2>Añadir un predictor categórico</h2>
<p>Para los predictores categóricos podemos crear primero una variable
binaria (0, 1) y luego añadir etiquetas a cada valor:</p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="co"># definir semilla</span></span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb102-3"><a href="#cb102-3"></a></span>
<span id="cb102-4"><a href="#cb102-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb102-5"><a href="#cb102-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb102-6"><a href="#cb102-6"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb102-7"><a href="#cb102-7"></a>b1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb102-8"><a href="#cb102-8"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb102-9"><a href="#cb102-9"></a></span>
<span id="cb102-10"><a href="#cb102-10"></a><span class="co"># variables aleatorias</span></span>
<span id="cb102-11"><a href="#cb102-11"></a>x1_num <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-12"><a href="#cb102-12"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1_num <span class="sc">+</span> error</span>
<span id="cb102-13"><a href="#cb102-13"></a></span>
<span id="cb102-14"><a href="#cb102-14"></a>x1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1_num, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb102-15"><a href="#cb102-15"></a></span>
<span id="cb102-16"><a href="#cb102-16"></a><span class="co"># crear data frame</span></span>
<span id="cb102-17"><a href="#cb102-17"></a>xy_datos_cat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x1_num, y)</span>
<span id="cb102-18"><a href="#cb102-18"></a></span>
<span id="cb102-19"><a href="#cb102-19"></a><span class="fu">head</span>(xy_datos_cat)</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
x1
</th>
<th style="text-align:center;">
x1_num
</th>
<th style="text-align:center;">
y
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.663
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
-3.841
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2.325
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
-0.438
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.428
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
-1.753
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Y así es como se escribe formalmente:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim \beta_{o} +
\beta_{1} * x_{1}\)</span></font>
</center>
<p> </p>
<p>Lo mismo que con los predictores continuos.</p>
<p>Podemos explorar el patrón de los datos utilizando un diagrama de
cajas (boxplot):</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># graficar</span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="fu">ggplot</span>(xy_datos_cat, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-74-1.png" width="672" />
 </p>
<p>… y obtener los estimados del modelo:</p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co"># construir modelos</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>xy_mod_cat <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1, <span class="at">data =</span> xy_datos_cat)</span>
<span id="cb104-3"><a href="#cb104-3"></a></span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="fu">summary</span>(xy_mod_cat)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1, data = xy_datos_cat)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -5.898 -1.909 -0.094  1.809  5.506 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -2.997      0.558   -5.37  2.3e-06 ***
## x1b            1.814      0.842    2.16    0.036 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.95 on 48 degrees of freedom
## Multiple R-squared:  0.0882, Adjusted R-squared:  0.0693 
## F-statistic: 4.65 on 1 and 48 DF,  p-value: 0.0362</code></pre>
<p> </p>
<p>… graficar los tamaños de efecto:</p>
<div class="sourceCode" id="cb106"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_cat<span class="sc">$</span>coefficients), <span class="at">est =</span> xy_mod_cat<span class="sc">$</span>coefficients,</span>
<span id="cb106-2"><a href="#cb106-2"></a>    <span class="fu">confint</span>(xy_mod_cat))</span>
<span id="cb106-3"><a href="#cb106-3"></a></span>
<span id="cb106-4"><a href="#cb106-4"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb106-5"><a href="#cb106-5"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span></span>
<span id="cb106-6"><a href="#cb106-6"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parámetro&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Tamaño de efecto&quot;</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-76-1.png" width="672" />
 </p>
<p>… y los gráficos diagnósticos del modelo:</p>
<div class="sourceCode" id="cb107"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="fu">plot_model</span>(xy_mod_cat, <span class="at">type =</span> <span class="st">&quot;diag&quot;</span>)[[<span class="dv">2</span>]]</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-77-1.png" width="80%" />
 </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Cuadro con los coeficientes (estimados):</p>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    -3.00      0.558   -5.37 2.27e-06
## x1b             1.81      0.842    2.16 3.62e-02</code></pre>
<ul>
<li><p>El modelo encontró que <span
class="math inline">\(\beta_1\)</span> (el tamaño de efecto de ‘x1’) es
1.814 y que es significativamente diferente de 0 (p = 0.036)</p></li>
<li><p>Los valores simulados de los parámetros de regresión pueden
compararse con el resumen del modelo <code>lm()</code> para tener una
idea de la precisión del modelo:</p>
<ul>
<li><span class="math inline">\(\beta_1\)</span> se fijó en 2 y se
estimó como 1.814.</li>
</ul></li>
<li><p>Tenga en cuenta que en este caso el intercepto se refiere a la
estimación del nivel ‘a’ en el predictor categórico, que se utilizó como
base:</p></li>
</ul>
<div class="sourceCode" id="cb109"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="co"># graficar</span></span>
<span id="cb109-2"><a href="#cb109-2"></a><span class="fu">ggplot</span>(xy_datos_cat, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> xy_mod_cat<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb109-3"><a href="#cb109-3"></a>    <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<ul>
<li>Por lo tanto, el intercepto es el mismo que la media de <em>y</em>
para la categoría ‘a’:</li>
</ul>
<div class="sourceCode" id="cb110"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="fu">mean</span>(xy_datos_cat<span class="sc">$</span>y[xy_datos_cat<span class="sc">$</span>x1 <span class="sc">==</span> <span class="st">&quot;a&quot;</span>])</span></code></pre></div>
<pre><code>## [1] -3</code></pre>
<ul>
<li>Observe también que la etiqueta del estimado es ‘x1b’, no ‘x1’ como
en los predictores continuos. Esto se debe a que en este caso el
estimado se refiere a la diferencia entre los dos niveles de la variable
categórica (‘a’ y ‘b’). Más concretamente, nos dice que en promedio las
observaciones de la categoría ‘b’ son 1.814 más altas que las
observaciones de la categoría ‘a’.</li>
</ul>
<p> </p>
</div>
<p> </p>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<p> </p>
<ul>
<li>Rico-Guevara A, &amp; M Araya-Salas. 2015. <a
href="https://academic.oup.com/beheco/article/26/1/21/2262689"><strong>Bills
as daggers? A test for sexually dimorphic weapons in a lekking
hummingbird species</strong></a>. <em>Behavioral Ecology</em>. 26 (1):
21-29.</li>
</ul>
<p>“<em>Los machos con puntas de pico más grandes y puntiagudas tuvieron
más éxito en ganar control de territorios en el lek.</em>”</p>
<p><img src="images/daggers_lbh.png" width="75%" style="display: block; margin: auto;" />
 </p>
</div>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 6</font></p>
<p> </p>
<ul>
<li>Los datos desbalanceados cuando hay categorías (es decir, algunas
categorías tienen muchas más observaciones que otras) pueden ser
problemáticos para la inferencia estadística. Modifique el código <a
href="#cb99-1">arriba</a> para simular un juego de datos muy
desbalanceado y compruebe la precisión del modelo.</li>
</ul>
</div>
<hr />
<div class="alert alert-warning">
<font size = 6>
<center>
Variables indicadoras (Dummy variables)
</center>
<p></font></p>
<p>En un modelo de regresión, los predictores categóricos también se
representan como vectores numéricos. Más concretamente, los predictores
categóricos se codifican como 0s y 1s, en los que 1 significa “pertenece
a la misma categoría” y 0 “pertenece a una categoría diferente”.
Mantuvimos el vector numérico original (‘x1_num’) al simular el juego de
datos con el predictor categórico:</p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="fu">head</span>(xy_datos_cat)</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
x1
</th>
<th style="text-align:center;">
x1_num
</th>
<th style="text-align:center;">
y
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.663
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
-3.841
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2.325
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
-0.438
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.428
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
-1.753
</td>
</tr>
</tbody>
</table>
<p>Observe que las “b” de la columna “x1” se convierten en 1 en la
columna “x1_num” y las “a” se convierten en 0. Esto se denomina variable
indicadora y el proceso se conoce como ‘codificación indicadora’ (dummy
coding).</p>
<p>En realidad, podemos utilizar el vector numérico en el modelo de
regresión y obtener exactamente los mismos resultados:</p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="co"># summary model with categorical variable</span></span>
<span id="cb113-2"><a href="#cb113-2"></a><span class="fu">summary</span>(xy_mod_cat)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    -3.00      0.558   -5.37 2.27e-06
## x1b             1.81      0.842    2.16 3.62e-02</code></pre>
<div class="sourceCode" id="cb115"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="co"># construir modelos with dummy variable</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>xy_mod_num <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1_num, <span class="at">data =</span> xy_datos_cat)</span>
<span id="cb115-3"><a href="#cb115-3"></a></span>
<span id="cb115-4"><a href="#cb115-4"></a><span class="co"># summary with dummy coding</span></span>
<span id="cb115-5"><a href="#cb115-5"></a><span class="fu">summary</span>(xy_mod_num)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    -3.00      0.558   -5.37 2.27e-06
## x1_num          1.81      0.842    2.16 3.62e-02</code></pre>
<p> </p>
<p>Las cosas se complican un poco más cuando se codifica un predictor
categórico con más de dos niveles. Pero la lógica es la misma.</p>
</div>
<p> </p>
<hr />
</div>
<div id="interacciones" class="section level2">
<h2>Interacciones</h2>
<p>Una interacción estadística se refiere a un efecto de una variable
predictora que está mediado por una segunda variable.</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim \beta_{o} +
\beta_{1} * x_{1} + \beta_{2} * x_{2} + \beta_{3} * x_{1} *
x_{2}\)</span></font>
</center>
<p> </p>
<p>Esto es más fácil de entender si se observa la interacción de una
variable continua y una binaria:</p>
<div class="sourceCode" id="cb117"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="co"># definir semilla</span></span>
<span id="cb117-2"><a href="#cb117-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb117-3"><a href="#cb117-3"></a></span>
<span id="cb117-4"><a href="#cb117-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb117-5"><a href="#cb117-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb117-6"><a href="#cb117-6"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb117-7"><a href="#cb117-7"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb117-8"><a href="#cb117-8"></a>b2 <span class="ot">&lt;-</span> <span class="fl">1.7</span></span>
<span id="cb117-9"><a href="#cb117-9"></a>b3 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb117-10"><a href="#cb117-10"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb117-11"><a href="#cb117-11"></a></span>
<span id="cb117-12"><a href="#cb117-12"></a><span class="co"># variables aleatorias</span></span>
<span id="cb117-13"><a href="#cb117-13"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span>
<span id="cb117-14"><a href="#cb117-14"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb117-15"><a href="#cb117-15"></a></span>
<span id="cb117-16"><a href="#cb117-16"></a><span class="co"># interaccion se añade como el producto dex1 y x2</span></span>
<span id="cb117-17"><a href="#cb117-17"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> b2 <span class="sc">*</span> x2 <span class="sc">+</span> b3 <span class="sc">*</span> x1 <span class="sc">*</span> x2 <span class="sc">+</span> error</span>
<span id="cb117-18"><a href="#cb117-18"></a></span>
<span id="cb117-19"><a href="#cb117-19"></a>x1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb117-20"><a href="#cb117-20"></a></span>
<span id="cb117-21"><a href="#cb117-21"></a><span class="co"># crear data frame</span></span>
<span id="cb117-22"><a href="#cb117-22"></a>xy_datos_intr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb117-23"><a href="#cb117-23"></a></span>
<span id="cb117-24"><a href="#cb117-24"></a><span class="fu">head</span>(xy_datos_intr)</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
x1
</th>
<th style="text-align:center;">
x2
</th>
<th style="text-align:center;">
y
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
1.0256
</td>
<td style="text-align:center;">
-4.01
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
-0.2848
</td>
<td style="text-align:center;">
-5.17
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
-1.2207
</td>
<td style="text-align:center;">
-1.40
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
0.1813
</td>
<td style="text-align:center;">
-1.02
</td>
</tr>
<tr>
<td style="text-align:center;">
a
</td>
<td style="text-align:center;">
-0.1389
</td>
<td style="text-align:center;">
-3.85
</td>
</tr>
<tr>
<td style="text-align:center;">
b
</td>
<td style="text-align:center;">
0.0058
</td>
<td style="text-align:center;">
4.14
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb118"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># construir modelos</span></span>
<span id="cb118-2"><a href="#cb118-2"></a>xy_mod_intr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1 <span class="sc">*</span> x2, <span class="at">data =</span> xy_datos_intr)</span>
<span id="cb118-3"><a href="#cb118-3"></a></span>
<span id="cb118-4"><a href="#cb118-4"></a><span class="co"># guardar resumen para graficar lineas de mejor ajuste</span></span>
<span id="cb118-5"><a href="#cb118-5"></a>xy_summ_intr <span class="ot">&lt;-</span> <span class="fu">summary</span>(xy_mod_intr)</span>
<span id="cb118-6"><a href="#cb118-6"></a></span>
<span id="cb118-7"><a href="#cb118-7"></a>xy_summ_intr</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1 + x2 + x1 * x2, data = xy_datos_intr)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.222 -1.664 -0.158  1.650  6.383 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -4.193      0.570   -7.35  2.7e-09 ***
## x1b            3.597      0.806    4.46  5.2e-05 ***
## x2             1.327      0.682    1.95   0.0576 .  
## x1b:x2        -2.972      0.962   -3.09   0.0034 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.83 on 46 degrees of freedom
## Multiple R-squared:  0.396,  Adjusted R-squared:  0.357 
## F-statistic:   10 on 3 and 46 DF,  p-value: 3.29e-05</code></pre>
<p>También ayuda graficar los datos:</p>
<div class="sourceCode" id="cb120"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># graficar</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_datos_intr, <span class="fu">aes</span>(<span class="at">x =</span> x2, <span class="at">y =</span> y, <span class="at">color =</span> x1)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb120-3"><a href="#cb120-3"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-88-1.png" width="80%" />
 </p>
<p>… y los tamaños de efecto:</p>
<div class="sourceCode" id="cb121"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">param =</span> <span class="fu">names</span>(xy_mod_intr<span class="sc">$</span>coefficients), <span class="at">est =</span> xy_mod_intr<span class="sc">$</span>coefficients,</span>
<span id="cb121-2"><a href="#cb121-2"></a>    <span class="fu">confint</span>(xy_mod_intr))</span>
<span id="cb121-3"><a href="#cb121-3"></a></span>
<span id="cb121-4"><a href="#cb121-4"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> est)) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb121-5"><a href="#cb121-5"></a>    <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X2.<span class="dv">5</span>.., <span class="at">ymax =</span> X97.<span class="dv">5</span>..)) <span class="sc">+</span></span>
<span id="cb121-6"><a href="#cb121-6"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parámetro&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Tamaño de efecto&quot;</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-89-1.png" width="672" />
 </p>
<p>También deberíamos revisar los gráficos de diagnóstico:</p>
<div class="sourceCode" id="cb122"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="fu">plot_model</span>(xy_mod_intr, <span class="at">type =</span> <span class="st">&quot;diag&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-90-1.png" width="80%" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-90-2.png" width="80%" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-90-3.png" width="80%" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-90-4.png" width="80%" />
 </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Cuadro con los coeficientes:</p>
<pre><code>##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    -4.19      0.570   -7.35 2.70e-09
## x1b             3.60      0.806    4.46 5.19e-05
## x2              1.33      0.682    1.95 5.76e-02
## x1b:x2         -2.97      0.962   -3.09 3.41e-03</code></pre>
<ul>
<li><p>El modelo encontró que <span
class="math inline">\(\beta_1\)</span> (el tamaño de efecto de ‘x1-b’ a
‘x1-a’) es 3.597 y que es significativamente diferente de 0 (valor p =
5.195^{-5})</p></li>
<li><p>El modelo encontró que <span
class="math inline">\(\beta_2\)</span> (el tamaño de efecto de ‘x2’) es
1.327 y que es significativamente diferente de 0 (p = 0.058). Esto es en
realidad la pendiente de la relación entre x2 e y cuando x1 =
`a’</p></li>
<li><p>El modelo encontró que <span
class="math inline">\(\beta_3\)</span> (el tamaño de efecto del término
de interacción ‘x1 * x2’) es -2.972 y que es significativamente
diferente de 0 (p = 0.003). Esta es la diferencia entre las pendientes
de x2 <em>vs</em> y cuando x1 = ‘a’ y x2 <em>vs</em> y cuando x1 =
‘b’.</p></li>
<li><p>Los valores simulados para los parámetros de regresión pueden
compararse con el resumen del modelo <code>lm()</code> para tener una
idea de la precisión del modelo:</p>
<ul>
<li><p><span class="math inline">\(\beta_1\)</span> se simuló con un
valor de 3 y se estimó en 3.597</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> se simuló con un
valor de 1.7 y se estimó en 1.327</p></li>
<li><p><span class="math inline">\(\beta_3\)</span> se simuló con un
valor de -3 y se estimó en -2.972</p></li>
</ul></li>
</ul>
</div>
<hr />
<p> </p>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<p> </p>
<ul>
<li>Chirino F, B Wilink, Araya-Salas M. In prep. <strong>Climatic
factors affecting vocal activity in lemur leaf frogs</strong>.</li>
</ul>
<p>“<em>El aumento de la luz de la luna disminuye la actividad vocal
de</em> Agalychnis lemur <em>aunque esta relación es mediada por la
temperatura.</em>”</p>
<p><img src="images/lemur.png" width="70%" style="display: block; margin: auto;" />
 </p>
</div>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 7</font></p>
<p> </p>
<ul>
<li><p>Modifique el <a href="#simular-un-predictor-asociado">código
usado para simular un único predictor asociado</a> aumentando
gradualmente el error. Esto se hace aumentando el argumento ‘sd’ en
<code>error &lt;- rnorm(n = n, sd = 2)</code>.</p></li>
<li><p>Mire cómo los errores más grandes afectan la inferencia (debe
volver a correr los modelos)</p></li>
<li><p>Ahora reemplace el término de error con
<code>error &lt;- rexp(n = n, rate = 0.2)</code>. Esto crea un error con
una distribución exponencial (por lo tanto no normal). Se supone que
esto es problemático para el poder inferencial de estos modelos. Compare
las estimaciones que obtuvo con los valores de la simulación (‘b0’ y
‘b1’). Explore la distribución de los residuos
(<code>plot(nombre_del_modelo)</code>) para los modelos de error
‘normal’ y ‘exponencial’.</p></li>
<li><p>Se supone que la colinealidad (la presencia de predictores
correlacionados) afecta a la estabilidad de la regresión múltiple. El
siguiente código crea dos predictores altamente colineales (‘x1’ y
‘x2’). La última línea de código muestra la correlación entre
ellos.</p></li>
</ul>
<div class="sourceCode" id="cb128"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="co"># definir semilla</span></span>
<span id="cb128-2"><a href="#cb128-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb128-3"><a href="#cb128-3"></a></span>
<span id="cb128-4"><a href="#cb128-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb128-5"><a href="#cb128-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb128-6"><a href="#cb128-6"></a>b0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb128-7"><a href="#cb128-7"></a>b1 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb128-8"><a href="#cb128-8"></a>b2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb128-9"><a href="#cb128-9"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb128-10"><a href="#cb128-10"></a></span>
<span id="cb128-11"><a href="#cb128-11"></a><span class="co"># variables aleatorias</span></span>
<span id="cb128-12"><a href="#cb128-12"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb128-13"><a href="#cb128-13"></a></span>
<span id="cb128-14"><a href="#cb128-14"></a><span class="co"># hacer x2 muy parecido a x1</span></span>
<span id="cb128-15"><a href="#cb128-15"></a>x2 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.3</span>)</span>
<span id="cb128-16"><a href="#cb128-16"></a></span>
<span id="cb128-17"><a href="#cb128-17"></a><span class="fu">cor</span>(x1, x2)</span></code></pre></div>
<pre><code>## [1] 0.946</code></pre>
<ul>
<li><p>Construya un modelo de regresión múltiple para estos datos (y ~
x1 + x2). Puede utilizar el mismo código que en la sección <a
href="#añadir-más-de-un-predictor:-regresión-múltiple">Añadir más de un
predictor: regresión múltiple</a>.</p></li>
<li><p>¿Cómo afecta a la inferencia la presencia de predictores
colineales? Realice los gráficos de diagnóstico para este modelo
(<code>plot(nombre_del_modelo)</code>).</p></li>
<li><p>Simule un juego de datos con tres predictores en los que sólo dos
de ellos son altamente colineales. Ajuste un modelo de regresión
múltiple (y ~ x1 + x2 + x3) para esos datos y observe cómo la
colinealidad afecta a la estimación del predictor no colineal.</p></li>
</ul>
<p> </p>
</div>
<hr />
</div>
</div>
<div
id="extender-los-modelos-lineales-a-estructuras-de-datos-más-complejas"
class="section level1">
<h1>Extender los modelos lineales a estructuras de datos más
complejas</h1>
<p> </p>
<div id="modelos-lineales-generalizados-glm" class="section level2">
<h2>Modelos lineales generalizados (GLM)</h2>
<p>Los GLM nos permiten modelar la asociación a variables respuesta que
no siguen una distribución normal. Además, permiten modelar
distribuciones que se asemejan más al proceso que generó los datos. El
siguiente código crea un juego de datos con una respuesta que representa
cuentas (por lo tanto, no normal):</p>
<div class="sourceCode" id="cb130"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="co"># definir semilla</span></span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb130-3"><a href="#cb130-3"></a></span>
<span id="cb130-4"><a href="#cb130-4"></a><span class="co"># numero de muestas</span></span>
<span id="cb130-5"><a href="#cb130-5"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb130-6"><a href="#cb130-6"></a></span>
<span id="cb130-7"><a href="#cb130-7"></a><span class="co"># coeficientes</span></span>
<span id="cb130-8"><a href="#cb130-8"></a>b0 <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb130-9"><a href="#cb130-9"></a>b1 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb130-10"><a href="#cb130-10"></a>b2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb130-11"><a href="#cb130-11"></a></span>
<span id="cb130-12"><a href="#cb130-12"></a></span>
<span id="cb130-13"><a href="#cb130-13"></a><span class="co"># generar variables</span></span>
<span id="cb130-14"><a href="#cb130-14"></a>y <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> n, <span class="at">lambda =</span> <span class="fl">6.5</span>)  <span class="co"># lambda = tasa promedio de exitos </span></span>
<span id="cb130-15"><a href="#cb130-15"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, , <span class="fu">length</span>(y))</span>
<span id="cb130-16"><a href="#cb130-16"></a>x1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(y) <span class="sc">-</span> b0 <span class="sc">-</span> b2 <span class="sc">*</span> x2)<span class="sc">/</span>b1</span>
<span id="cb130-17"><a href="#cb130-17"></a></span>
<span id="cb130-18"><a href="#cb130-18"></a><span class="co"># crear data frame</span></span>
<span id="cb130-19"><a href="#cb130-19"></a>xy_datos_pois <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, x2, y)</span>
<span id="cb130-20"><a href="#cb130-20"></a></span>
<span id="cb130-21"><a href="#cb130-21"></a><span class="fu">head</span>(xy_datos_pois)</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
x1
</th>
<th style="text-align:center;">
x2
</th>
<th style="text-align:center;">
y
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
0.143
</td>
<td style="text-align:center;">
-0.500
</td>
<td style="text-align:center;">
4
</td>
</tr>
<tr>
<td style="text-align:center;">
0.574
</td>
<td style="text-align:center;">
-0.480
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
0.574
</td>
<td style="text-align:center;">
-0.459
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
0.574
</td>
<td style="text-align:center;">
-0.439
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
0.767
</td>
<td style="text-align:center;">
-0.418
</td>
<td style="text-align:center;">
9
</td>
</tr>
<tr>
<td style="text-align:center;">
0.574
</td>
<td style="text-align:center;">
-0.398
</td>
<td style="text-align:center;">
7
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>También grafiquemos ‘x1’ <em>vs</em> ‘y’:</p>
<div class="sourceCode" id="cb131"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="co"># graficar</span></span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="fu">ggplot</span>(xy_datos_pois, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-98-1.png" width="672" />
 </p>
<p>La relación no parece muy lineal ni la varianza parece ser constante
a través de ‘x1’.</p>
<p>Podemos relajar el requisito de la distribución normal con GLMs.
<code>glm()</code> es una función básica de R que nos ayuda a hacer el
truco. Para este ejemplo la distribución más apropiada es
<em>Poisson</em>. Esto se puede establecer en el argumento `family’
así:</p>
<div class="sourceCode" id="cb132"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a>glm_pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> xy_datos_pois, <span class="at">family =</span> <span class="fu">poisson</span>())</span></code></pre></div>
<p> </p>
<p>Que es equivalente a esto:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim_{poisson}
\beta_{o} + \beta_{1} * x_{1} + \beta_{2} * x_{2}\)</span></font>
</center>
<p> </p>
<p>Como puede ver el único argumento extra comparado con
<code>lm()</code> es <code>family</code>. El resto es simplemente la
“fórmula” y los “datos” con los que ya estamos familiarizados. Así que,
de nuevo, podemos aprovechar nuestros conocimientos sobre los modelos
lineales para extenderlos a estructuras de datos más complejas.</p>
<p>También necesitamos ejecutar <code>summary()</code> para obtener el
resultado del modelo:</p>
<div class="sourceCode" id="cb133"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="fu">summary</span>(glm_pois)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x1 + x2, family = poisson(), data = xy_datos_pois)
## 
## Deviance Residuals: 
##       Min         1Q     Median         3Q        Max  
## -2.58e-08  -1.49e-08   0.00e+00   0.00e+00   2.98e-08  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 1.20e+00   1.29e-01    9.31  &lt; 2e-16 ***
## x1          1.30e+00   2.20e-01    5.92  3.2e-09 ***
## x2          3.51e-16   1.90e-01    0.00        1    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 3.9471e+01  on 49  degrees of freedom
## Residual deviance: 5.7732e-15  on 47  degrees of freedom
## AIC: 186.9
## 
## Number of Fisher Scoring iterations: 3</code></pre>
<p> </p>
<p> </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Cuadro de los coeficientes (estimados):</p>
<pre><code>##             Estimate Std. Error  z value Pr(&gt;|z|)
## (Intercept) 1.20e+00      0.129 9.31e+00 1.27e-20
## x1          1.30e+00      0.220 5.92e+00 3.22e-09
## x2          3.51e-16      0.190 1.85e-15 1.00e+00</code></pre>
<ul>
<li><p>El modelo nos dice que <span
class="math inline">\(\beta_1\)</span> (el tamaño de efecto de ‘x1’) es
1.3 y que es significativamente diferente de 0 (p = 3.22^{-9}). Esto se
interpreta en realidad como que un aumento de 1 unidad de ‘x1’ resulta
en ‘y’ (tasa) en un factor de exp(1.3) = 3.669.</p></li>
<li><p>El modelo también nos dice que <span
class="math inline">\(\beta_2\)</span> (el tamaño de efecto de ‘x2’) es
3.51^{-16} y que es significativamente diferente de 0 (p = 1). Esto
significa que un aumento en 1 unidad de ‘x2’ resulta en ‘y’ (tasa) en un
factor de exp(3.51^{-16}) = 1.</p></li>
</ul>
</div>
<p> </p>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<p> </p>
<ul>
<li>Topp, E. N., Tscharntke, T., &amp; Loos, J. (2022). <a
href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/ddi.13257"><strong>Fire
and landscape context shape plant and butterfly diversity in a South
African shrubland</strong></a>. <em>Diversity and Distributions</em>,
28(3), 357-371.</li>
</ul>
<p>“<em>La riqueza de especies de mariposas es de tres a cuatro veces
mayor cuando aumenta el hábitat natural en el paisaje circundante (en un
radio de 2 km), mientras que la abundancia de mariposas se asociaba
negativamente con el aumento del tiempo transcurrido desde el último
incendio.</em>”</p>
<p><img src="images/butterflies.png" width="100%" style="display: block; margin: auto;" />
 </p>
</div>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Ejercicio 8</font></p>
<p> </p>
<ul>
<li>Intente correr un modelo <code>lm()</code> (con una distribución
gaussiana), compare los resultados y compruebe los residuos
(<code>plot_model(model_name, type = "diag")</code>)</li>
</ul>
</div>
<p> </p>
<p>Existen muchas otras funciones de distribución y enlace:</p>
<p><img src="images/link-functions.jpg" width="80%" style="display: block; margin: auto;" />
 </p>
<hr />
</div>
<div id="modelos-de-efectos-variables-modelos-mixtos"
class="section level2">
<h2>Modelos de efectos variables (modelos mixtos)</h2>
<p>A veces nuestros conjuntos de datos incluyen estructuras con varios
niveles de organización. Por ejemplo, cuando tomamos muestras de varios
individuos de diferentes poblaciones. En esos casos, la variación en el
nivel estructural superior (poblaciones) podría impedir la detección de
patrones en el nivel inferior (individuos).</p>
<p>Vamos a simular algunos datos que se asemejan a ese escenario.
Tenemos dos predictores continuos (x1) y una respuesta continua (y).
Cada muestra procede de 1 de 8 poblaciones diferentes (poblacion):</p>
<div class="sourceCode" id="cb136"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="co"># x&lt;- 1 definir semilla</span></span>
<span id="cb136-2"><a href="#cb136-2"></a><span class="fu">set.seed</span>(<span class="dv">28</span>)</span>
<span id="cb136-3"><a href="#cb136-3"></a></span>
<span id="cb136-4"><a href="#cb136-4"></a><span class="co"># numero de observaciones</span></span>
<span id="cb136-5"><a href="#cb136-5"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb136-6"><a href="#cb136-6"></a>b0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb136-7"><a href="#cb136-7"></a>b1 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb136-8"><a href="#cb136-8"></a>poblacion <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb136-9"><a href="#cb136-9"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb136-10"><a href="#cb136-10"></a></span>
<span id="cb136-11"><a href="#cb136-11"></a><span class="co"># variables aleatorias</span></span>
<span id="cb136-12"><a href="#cb136-12"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb136-13"><a href="#cb136-13"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> poblacion <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="sc">+</span> error</span>
<span id="cb136-14"><a href="#cb136-14"></a></span>
<span id="cb136-15"><a href="#cb136-15"></a><span class="co"># add letters</span></span>
<span id="cb136-16"><a href="#cb136-16"></a>poblacion <span class="ot">&lt;-</span> letters[poblacion <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb136-17"><a href="#cb136-17"></a></span>
<span id="cb136-18"><a href="#cb136-18"></a><span class="co"># create data set</span></span>
<span id="cb136-19"><a href="#cb136-19"></a>xy_datos_mixto <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x1, y, poblacion)</span>
<span id="cb136-20"><a href="#cb136-20"></a></span>
<span id="cb136-21"><a href="#cb136-21"></a><span class="fu">head</span>(xy_datos_mixto, <span class="dv">10</span>)</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
x1
</th>
<th style="text-align:center;">
y
</th>
<th style="text-align:center;">
poblacion
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1.546
</td>
<td style="text-align:center;">
3.34
</td>
<td style="text-align:center;">
a
</td>
</tr>
<tr>
<td style="text-align:center;">
0.568
</td>
<td style="text-align:center;">
3.14
</td>
<td style="text-align:center;">
a
</td>
</tr>
<tr>
<td style="text-align:center;">
-0.638
</td>
<td style="text-align:center;">
15.28
</td>
<td style="text-align:center;">
i
</td>
</tr>
<tr>
<td style="text-align:center;">
0.984
</td>
<td style="text-align:center;">
2.66
</td>
<td style="text-align:center;">
a
</td>
</tr>
<tr>
<td style="text-align:center;">
1.054
</td>
<td style="text-align:center;">
3.73
</td>
<td style="text-align:center;">
b
</td>
</tr>
<tr>
<td style="text-align:center;">
-0.823
</td>
<td style="text-align:center;">
3.02
</td>
<td style="text-align:center;">
a
</td>
</tr>
<tr>
<td style="text-align:center;">
-1.324
</td>
<td style="text-align:center;">
3.22
</td>
<td style="text-align:center;">
c
</td>
</tr>
<tr>
<td style="text-align:center;">
2.179
</td>
<td style="text-align:center;">
19.05
</td>
<td style="text-align:center;">
i
</td>
</tr>
<tr>
<td style="text-align:center;">
2.265
</td>
<td style="text-align:center;">
15.45
</td>
<td style="text-align:center;">
i
</td>
</tr>
<tr>
<td style="text-align:center;">
-0.778
</td>
<td style="text-align:center;">
11.67
</td>
<td style="text-align:center;">
h
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Podemos explorar la relación entre ‘y’ y ‘x1’ con un gráfico:</p>
<div class="sourceCode" id="cb137"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_datos_mixto, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-105-1.png" width="672" />
 </p>
<p>¿Puede ver claramente el patrón de asociación entre las dos variables
que hemos utilizado para simular los datos? Podemos seguir explorando
los datos con un modelo de regresión lineal simple:</p>
<div class="sourceCode" id="cb138"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x1, <span class="at">data =</span> xy_datos_mixto))</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x1, data = xy_datos_mixto)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -11.755  -5.119   0.186   4.602  12.409 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    8.852      0.325   27.21   &lt;2e-16 ***
## x1             0.633      0.329    1.92    0.055 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.63 on 298 degrees of freedom
## Multiple R-squared:  0.0123, Adjusted R-squared:  0.00895 
## F-statistic:  3.7 on 1 and 298 DF,  p-value: 0.0554</code></pre>
<p> </p>
<p>A pesar de haber simulado un <span
class="math inline">\(\beta_1\)</span> distinto de cero, no tenemos
ninguna asociación significativa según este modelo y la estimación de
<span class="math inline">\(\beta_1\)</span> está muy lejos de la
simulada. Esta pobre inferencia se debe a que estamos ignorando una
característica importante de nuestros datos, la agrupación de las
muestras en “poblaciones”.</p>
<p>Los modelos de efectos mixtos (también conocidos como modelos
multinivel o modelos de efectos variables) pueden ayudarnos a tener en
cuenta estas características adicionales, mejorando significativamente
nuestro poder de inferencia. Coloreemos cada una de las poblaciones para
ver cómo covarían las variables en cada subgrupo de datos:</p>
<div class="sourceCode" id="cb140"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_datos_mixto, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y, <span class="at">color =</span> poblacion)) <span class="sc">+</span></span>
<span id="cb140-2"><a href="#cb140-2"></a>    <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-107-1.png" width="672" />
 </p>
<p>Parece haber un patrón claro de asociación positiva entre x1 e y. El
patrón se hace un poco más evidente si mostramos cada población en su
propio panel:</p>
<div class="sourceCode" id="cb141"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> xy_datos_mixto, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y, <span class="at">color =</span> poblacion)) <span class="sc">+</span></span>
<span id="cb141-2"><a href="#cb141-2"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>poblacion) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb141-3"><a href="#cb141-3"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="modelos_de_regresion_files/figure-html/unnamed-chunk-108-1.png" width="100%" />
 </p>
<p>Construyamos un modelo de efectos mixtos utilizando la población como
intercepto variable:</p>
<div class="sourceCode" id="cb142"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a>mix_eff_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">formula =</span> y <span class="sc">~</span> x1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> poblacion), <span class="at">data =</span> xy_datos_mixto)</span></code></pre></div>
<p>Que es equivalente a esto:</p>
<center>
<font size = 6><span class="math inline">\(\hat{Y} \sim_{gausiana}
(\beta_{o} + \beta_{grupo}) + \beta_{1} * x_{1}\)</span></font>
</center>
<p> </p>
<p>Podemos ver el resultado del modelo igual que con un modelo
<code>lm()</code>:</p>
<div class="sourceCode" id="cb143"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="fu">summary</span>(mix_eff_mod)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [&#39;lmerModLmerTest&#39;]
## Formula: y ~ x1 + (1 | poblacion)
##    Data: xy_datos_mixto
## 
## REML criterion at convergence: 1296
## 
## Scaled residuals: 
##    Min     1Q Median     3Q    Max 
## -3.524 -0.657 -0.032  0.612  3.245 
## 
## Random effects:
##  Groups    Name        Variance Std.Dev.
##  poblacion (Intercept) 30.07    5.48    
##  Residual               3.76    1.94    
## Number of obs: 300, groups:  poblacion, 9
## 
## Fixed effects:
##             Estimate Std. Error      df t value Pr(&gt;|t|)    
## (Intercept)    8.788      1.831   8.003     4.8   0.0014 ** 
## x1             1.317      0.115 290.068    11.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##    (Intr)
## x1 -0.003</code></pre>
<p> </p>
<p>El modelo detectó correctamente el patrón simulado y la estimación de
<span class="math inline">\(\beta_1\)</span> (1.317) es muy cercana al
valor simulado.</p>
<p> </p>
<div class="alert alert-warning">
<center>
<font size="5"><b>Caso de estudio</b></font>
</center>
<p> </p>
<ul>
<li>Araya-Salas M, P González-Gómez, K Wojczulanis-Jakubas, V López III
&amp; T Wright. 2018. <a
href="https://www.nature.com/articles/s41598-018-20441-x"><strong>Spatial
memory is as important as weapon and body size for territorial ownership
in a lekking hummingbird</strong></a>. <em>Scientific Reports</em>. 13,
e0189969</li>
</ul>
<p>“<em>… el tamaño corporal mostró una correlación negativa con la
frecuencia baja del canto.</em>”</p>
<p><img src="images/lbh_song_size.png" width="80%" style="display: block; margin: auto;" />
 </p>
</div>
<p> </p>
<div class="alert alert-success">
<p> </p>
<center>
<font size="5"><b>Interpretación del modelo</b></font>
</center>
<p> </p>
<p>Cuadro con los coeficientes (estimados):</p>
<pre><code>##             Estimate Std. Error  df t value Pr(&gt;|t|)
## (Intercept)     8.79      1.831   8     4.8 1.36e-03
## x1              1.32      0.115 290    11.4 2.93e-25</code></pre>
<p> </p>
<ul>
<li><p>El modelo encontró que <span
class="math inline">\(\beta_1\)</span> (el tamaño de efecto de ‘x1’) es
1.317 y que es significativamente diferente de 0 (p =
2.933^{-25})</p></li>
<li><p>Los valores simulados de los parámetros de regresión pueden
compararse con el resumen del modelo <code>lmer()</code> para tener una
idea de la precisión del modelo:</p>
<ul>
<li><span class="math inline">\(\beta_1\)</span> se fijó en 1.3 y se
estimó como 1.317.</li>
</ul></li>
<li><p>La varianza del intercepto para cada población fue de 29.956 y la
desviación estándar de 5.473</p></li>
<li><p>Los interceptos estimados para cada población son:</p></li>
</ul>
<div class="sourceCode" id="cb146"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="fu">ranef</span>(mix_eff_mod)<span class="sc">$</span>poblacion</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
(Intercept)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
-8.228
</td>
</tr>
<tr>
<td style="text-align:center;">
-6.171
</td>
</tr>
<tr>
<td style="text-align:center;">
-4.231
</td>
</tr>
<tr>
<td style="text-align:center;">
-1.308
</td>
</tr>
<tr>
<td style="text-align:center;">
0.246
</td>
</tr>
<tr>
<td style="text-align:center;">
2.225
</td>
</tr>
<tr>
<td style="text-align:center;">
3.916
</td>
</tr>
<tr>
<td style="text-align:center;">
5.756
</td>
</tr>
<tr>
<td style="text-align:center;">
7.796
</td>
</tr>
</tbody>
</table>
<p> </p>
<ul>
<li>Podemos compararlos con los promedios para cada población en los
datos:</li>
</ul>
<div class="sourceCode" id="cb147"><pre
class="sourceCode numberSource r numberLines lineAnchors"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="co"># sumar interceptos por poblacion a el intercepto total</span></span>
<span id="cb147-2"><a href="#cb147-2"></a>interceptos <span class="ot">&lt;-</span> <span class="fu">ranef</span>(mix_eff_mod)<span class="sc">$</span>poblacion <span class="sc">+</span> <span class="fu">fixef</span>(mix_eff_mod)[<span class="dv">1</span>]</span>
<span id="cb147-3"><a href="#cb147-3"></a></span>
<span id="cb147-4"><a href="#cb147-4"></a><span class="co"># calcular los promedios por poblacion en los datos</span></span>
<span id="cb147-5"><a href="#cb147-5"></a>prom_pobs <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(y <span class="sc">~</span> poblacion, xy_datos_mixto, mean)</span>
<span id="cb147-6"><a href="#cb147-6"></a></span>
<span id="cb147-7"><a href="#cb147-7"></a><span class="co"># unir</span></span>
<span id="cb147-8"><a href="#cb147-8"></a><span class="fu">cbind</span>(interceptos, <span class="at">prom_pobs =</span> prom_pobs[, <span class="dv">2</span>])</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
(Intercept)
</th>
<th style="text-align:center;">
prom_pobs
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
0.56
</td>
<td style="text-align:center;">
0.862
</td>
</tr>
<tr>
<td style="text-align:center;">
2.62
</td>
<td style="text-align:center;">
2.769
</td>
</tr>
<tr>
<td style="text-align:center;">
4.56
</td>
<td style="text-align:center;">
4.901
</td>
</tr>
<tr>
<td style="text-align:center;">
7.48
</td>
<td style="text-align:center;">
7.732
</td>
</tr>
<tr>
<td style="text-align:center;">
9.03
</td>
<td style="text-align:center;">
8.877
</td>
</tr>
<tr>
<td style="text-align:center;">
11.01
</td>
<td style="text-align:center;">
10.777
</td>
</tr>
<tr>
<td style="text-align:center;">
12.70
</td>
<td style="text-align:center;">
12.627
</td>
</tr>
<tr>
<td style="text-align:center;">
14.54
</td>
<td style="text-align:center;">
14.621
</td>
</tr>
<tr>
<td style="text-align:center;">
16.58
</td>
<td style="text-align:center;">
16.425
</td>
</tr>
</tbody>
</table>
<p> </p>
<ul>
<li>La varianza entre los niveles del factor aleatorio
(<code>poblacion</code>) es de 29.956 y la desviación estándar de
5.473</li>
</ul>
<p> </p>
</div>
<p> </p>
<div id="la-paradoja-de-simpson" class="section level3">
<h3>La paradoja de Simpson</h3>
<p>La paradoja de Simpson es un fenómeno en estadística en el que una
tendencia aparece en varios grupos de datos pero desaparece o se
invierte cuando se combinan los grupos. Se ha utilizado para ilustrar el
tipo de resultados engañosos que puede generar el ignorar la estructura
en los datos y las relaciones causales entre variables.</p>
<p><img src="images/simpsons_paradox.gif" width="80%" style="display: block; margin: auto;" /></p>
<p><font size="3">Tomado de wikipedia</font></p>
<p> </p>
<p>La estructura de los datos debido a observaciones pertenecientes al
mismo grupo puede ser tomada en cuenta usando el grupo como un factor
aleatorio, tal y como se hizo en el ejemplo anterior.</p>
<p> </p>
<div class="alert alert-info">
<center>
<b><font size="5">Modelos lineales como abordaje estadístico estándar
</font></b>
</center>
<p><img src="images/swiss_knife.png" width="40%" style="display: block; margin: auto;" /></p>
<center>
<font size = 5><span class="math inline">\(\hat{Y} \sim_{función\ de\
enlace} (\beta_{o} + \beta_{grupo}) + \beta_{1} * x_{1} + \cdots +
\beta_{n} * x_{n}\)</span></font>
</center>
<ul>
<li><p>Este modelo básico incluye una función de enlace que cuando es
gausiana (i.e. normal) equivale a un modelo lineal y cuando no, a un
modelo generalizado</p></li>
<li><p>Cuando el <span class="math inline">\(\beta_{grupo}\)</span> es
diferente entre grupos (i.e. cuando el intercepto difiere entre grupos)
es un modelo mixto con intercepto variable (i.e. aleatorio)</p></li>
</ul>
<p> </p>
</div>
<p> </p>
<p>Este manual solo pretende sugerir un abordaje estadístico centrado en
los modelos de regresión desde el cual se pueden llevar a cabo
adecuadamente la mayoría de los análisis estadísticos que usamos en
biología. <strong>El manual no tiene como objetivo explicar en detalle
las particularidades de los modelos generalizados y mixtos</strong>.
Note que estos modelos, principalmente los mixtos, pueden adaptarse a
otras estructuras de datos mas complejas no cubiertas aquí, como lo son
las pendientes aleatorias, pendientes e interceptos aleatorios,
estructuras de correlación (i.e. autocorrelación espacial o temporal,
pedigrís o árboles filogenéticos), medidas repetidas y el uso de
pseudoreplicas, entre otras.</p>
<p> </p>
<hr />
</div>
</div>
<div id="referencias" class="section level2">
<h2>Referencias</h2>
<ul>
<li><p><a
href="https://github.com/rmcelreath/stat_rethinking_2022">Richard
McElreath’s Statistical Rethinking book</a></p></li>
<li><p><a
href="https://www.programmingr.com/examples/neat-tricks/sample-r-function/r-rbinom/">R’s
rbinom – Simulate Binomial or Bernoulli trials</a></p></li>
<li><p><a
href="https://www.programmingr.com/examples/neat-tricks/sample-r-function/r-rnorm/">R’s
rnorm – selecting values from a normal distribution</a></p></li>
<li><p><a
href="https://www.programmingr.com/examples/neat-tricks/sample-r-function/rexp/">R’s
exp – Simulating Exponential Distributions</a></p></li>
<li><p><a
href="https://aosmith.rbind.io/2018/08/29/getting-started-simulating-data/">Simulating
data in R</a></p></li>
</ul>
<p> </p>
<hr />
<p><font size="4">Información de la sesión</font></p>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.2 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/atlas/libblas.so.3.10.3
## LAPACK: /usr/lib/x86_64-linux-gnu/atlas/liblapack.so.3.10.3
## 
## locale:
##  [1] LC_CTYPE=pt_BR.UTF-8       LC_NUMERIC=C               LC_TIME=es_CR.UTF-8       
##  [4] LC_COLLATE=pt_BR.UTF-8     LC_MONETARY=es_CR.UTF-8    LC_MESSAGES=pt_BR.UTF-8   
##  [7] LC_PAPER=es_CR.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
## [10] LC_TELEPHONE=C             LC_MEASUREMENT=es_CR.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] car_3.0-11          carData_3.0-4       sjPlot_2.8.11       lmerTest_3.1-3     
##  [5] lme4_1.1-27.1       Matrix_1.3-4        scales_1.2.0        MASS_7.3-54        
##  [9] emo_0.0.0.9000      viridis_0.6.2       viridisLite_0.4.0   xaringanExtra_0.7.0
## [13] ggplot2_3.3.6       RColorBrewer_1.1-3  kableExtra_1.3.1    knitr_1.39         
## 
## loaded via a namespace (and not attached):
##   [1] TH.data_1.1-0       minqa_1.2.4         colorspace_2.0-3    ellipsis_0.3.2     
##   [5] rio_0.5.27          rsconnect_0.8.27    sjlabelled_1.2.0    estimability_1.4.1 
##   [9] parameters_0.18.2   rstudioapi_0.13     farver_2.1.1        remotes_2.4.0      
##  [13] fansi_1.0.3         mvtnorm_1.1-2       lubridate_1.7.10    xml2_1.3.2         
##  [17] codetools_0.2-18    splines_4.1.0       sjmisc_2.8.9        jsonlite_1.8.0     
##  [21] nloptr_1.2.2.2      ggeffects_1.1.3     broom_0.7.8         effectsize_0.7.0.5 
##  [25] compiler_4.1.0      httr_1.4.2          sjstats_0.18.1      emmeans_1.8.1-1    
##  [29] backports_1.3.0     assertthat_0.2.1    fastmap_1.1.0       cli_3.3.0          
##  [33] formatR_1.11        htmltools_0.5.3     tools_4.1.0         coda_0.19-4        
##  [37] gtable_0.3.0        glue_1.6.2          dplyr_1.0.7         Rcpp_1.0.9         
##  [41] cellranger_1.1.0    jquerylib_0.1.4     vctrs_0.4.1         nlme_3.1-152       
##  [45] insight_0.18.4      xfun_0.31           stringr_1.4.0       openxlsx_4.2.4     
##  [49] rvest_1.0.0         lifecycle_1.0.1     zoo_1.8-9           ragg_1.1.3         
##  [53] hms_1.1.0           sandwich_3.0-1      yaml_2.3.5          curl_4.3.2         
##  [57] gridExtra_2.3       sass_0.4.0          stringi_1.7.8       highr_0.9          
##  [61] bayestestR_0.13.0   zip_2.2.0           boot_1.3-28         rlang_1.0.5        
##  [65] pkgconfig_2.0.3     systemfonts_1.0.2   evaluate_0.15       lattice_0.20-44    
##  [69] purrr_0.3.4         labeling_0.4.2      tidyselect_1.1.1    magrittr_2.0.3     
##  [73] R6_2.5.1            generics_0.1.0      multcomp_1.4-17     DBI_1.1.1          
##  [77] pillar_1.8.0        haven_2.4.1         foreign_0.8-81      withr_2.5.0        
##  [81] mgcv_1.8-36         abind_1.4-5         survival_3.2-11     datawizard_0.6.0   
##  [85] tibble_3.1.8        performance_0.9.2   modelr_0.1.8        crayon_1.5.1       
##  [89] uuid_0.1-4          utf8_1.2.2          rmarkdown_2.16      readxl_1.3.1       
##  [93] grid_4.1.0          isoband_0.2.5       data.table_1.14.0   forcats_0.5.1      
##  [97] digest_0.6.29       webshot_0.5.2       xtable_1.8-4        tidyr_1.1.3        
## [101] numDeriv_2016.8-1.1 textshaping_0.3.5   munsell_0.5.0       bslib_0.2.5.1</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
